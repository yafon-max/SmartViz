<template>
  <!-- Êï¥‰ΩìÂÆπÂô®Ôºö3DÊ®°ÂûãÂ±ïÁ§∫È°µÈù¢ÁöÑÈ°∂Â±ÇÂÆπÂô® -->
  <div class="model-3d">
    <!-- ‰∏ªÂÆπÂô®ÔºöÂåÖÂê´ÊâÄÊúâÈù¢ÊùøÂíå3DÁîªÂ∏É -->
    <div class="main-container">
      <!-- Â∑¶‰æßÊéßÂà∂Èù¢ÊùøÔºöÂåÖÂê´ÂêÑÁßçÊéßÂà∂ÈÄâÈ°π -->
      <div class="left-panel">
        <!-- ÂõæÂ±ÇÊéßÂà∂Èù¢ÊùøÔºöÊéßÂà∂‰∏çÂêåÂõæÂ±ÇÁöÑÊòæÁ§∫/ÈöêËóè -->
        <div class="mac-panel panel-section">
          <h3 class="panel-title">{{ t('model3d.panels.layerControl.title') }}</h3>
          <div class="info-content">
            <div class="layer-controls">
            <!-- Ê∑ªÂä†ÁöÑÊ®°ÂûãÂä†ËΩΩËøõÂ∫¶Êù°ÊòæÁ§∫ - ‰ªÖÂú®Âä†ËΩΩÂ§ßÂûãÊ®°ÂûãÊó∂ÊòæÁ§∫ -->
            <div v-if="modelLoading.isLoading" class="loading-progress">
              <div class="loading-text">{{ t('model3d.loading.text', 'Ê≠£Âú®Âä†ËΩΩ') + ': ' + modelLoading.model + t('model3d.loading.notice', '3DÊ®°Âûã') }}

              </div>
              <div class="progress-bar">
                <div class="progress-fill" :style="{width: modelLoading.progress + '%'}"></div>
              </div>
              <div class="progress-text">{{ modelLoading.progress.toFixed(1) + '%' }}</div>
            </div>
            
            <!-- Âª∫Á≠ëÁâ©ÂõæÂ±ÇÊéßÂà∂ -->
            <div class="layer-item">
              <!-- v-modelÂèåÂêëÁªëÂÆölayers.buildingsÔºåÂΩìÂ§çÈÄâÊ°ÜÁä∂ÊÄÅÊîπÂèòÊó∂Ëß¶ÂèëtoggleLayerÂáΩÊï∞ -->
              <input type="checkbox" id="buildingLayer" v-model="layers.buildings" @change="toggleLayer('buildings')">
              <label for="buildingLayer">{{ t('model3d.panels.layerControl.buildings') }}</label>
            </div>
            <!-- ÈÅìË∑ØÂõæÂ±ÇÊéßÂà∂
            <div class="layer-item">
              <input type="checkbox" id="roadLayer" v-model="layers.roads" @change="toggleLayer('roads')">
              <label for="roadLayer">{{ t('model3d.panels.layerControl.roads') }}</label>
            </div> -->
            <!-- ÊëÑÂÉèÂ§¥‰ΩçÁΩÆÂõæÂ±ÇÊéßÂà∂ -->
            <div class="layer-item">
              <input type="checkbox" id="cameraLayer" v-model="layers.cameras" @change="toggleLayer('cameras')">
              <label for="cameraLayer">{{ t('model3d.panels.layerControl.cameras') }}</label>
            </div>
            <!-- ÊëÑÂÉèÂ§¥ËßÜÁ∫øÁ∫øÊÆµÂõæÂ±ÇÊéßÂà∂ -->
            <div class="layer-item">
              <input type="checkbox" id="visionLinesLayer" v-model="layers.visionLines" @change="toggleLayer('visionLines')">
              <label for="visionLinesLayer">{{ t('model3d.panels.layerControl.visionLines') }}</label>
            </div>
            <!-- ÊëÑÂÉèÂ§¥ËßÜÈáéÂπ≥Èù¢ÂõæÂ±ÇÊéßÂà∂ -->
            <div class="layer-item">
              <input type="checkbox" id="visionPlaneLayer" v-model="layers.visionPlane" @change="toggleLayer('visionPlane')">
              <label for="visionPlaneLayer">{{ t('model3d.panels.layerControl.visionPlane') }}</label>
            </div>
            <!-- Êï∞ÊçÆÁÉ≠ÁÇπÂõæÂ±ÇÊéßÂà∂ -->
            <div class="layer-item">
              <input type="checkbox" id="dataLayer" v-model="layers.data" @change="toggleLayer('data')">
              <label for="dataLayer">{{ t('model3d.panels.layerControl.data') }}</label>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ËßÜËßíÊéßÂà∂Èù¢ÊùøÔºöÁÆ°ÁêÜ3DÂú∫ÊôØÁöÑËßÜËßí -->
        <div class="mac-panel panel-section">
          <h3 class="panel-title">{{ t('model3d.panels.viewControl.title') }}</h3>
          <div class="view-controls">
            <!-- ÈáçÁΩÆËßÜËßíÊåâÈíÆÔºöÁÇπÂáªÊó∂Ë∞ÉÁî®resetViewÂáΩÊï∞ -->
            <button @click="resetView" class="mac-button control-btn">
              <span class="icon">‚ü≤</span> {{ t('model3d.panels.viewControl.resetView') }}
            </button>
            <!-- ÂàáÊç¢Á∫øÊ°ÜÊ®°ÂºèÔºöÁÇπÂáªÊó∂Ë∞ÉÁî®toggleWireframeÂáΩÊï∞ÔºåÊñáÊú¨Ê†πÊçÆisWireframeÁä∂ÊÄÅÂèòÂåñ -->
            <button @click="toggleWireframe" class="mac-button control-btn">
              <span class="icon">‚äû</span> {{ isWireframe ? t('model3d.panels.viewControl.wireframeOff') : t('model3d.panels.viewControl.wireframeOn') }}
            </button>
          </div>
        </div>
        
        <!-- Êï∞ÊçÆÊòæÁ§∫ÊéßÂà∂Èù¢ÊùøÔºöÈÄâÊã©Ë¶ÅÊòæÁ§∫ÁöÑÊï∞ÊçÆÁ±ªÂûã -->
        <div class="mac-panel panel-section">
          <h3 class="panel-title">{{ t('model3d.panels.dataDisplay.title') }}</h3>
          <div class="data-select">
            <!-- Êï∞ÊçÆÁ±ªÂûãÈÄâÊã©Âô®Ôºöv-modelÁªëÂÆöselectedDataÔºåÊîπÂèòÊó∂Ëß¶ÂèëupdateDataVisualizationÂáΩÊï∞ -->
            <select v-model="selectedData" @change="updateDataVisualization" class="mac-select">
              <option value="none">{{ t('model3d.panels.dataDisplay.noData') }}</option>
              <option value="pedestrian">{{ t('model3d.panels.dataDisplay.pedestrian') }}</option>
              <option value="vehicle">{{ t('model3d.panels.dataDisplay.vehicle') }}</option>
              <option value="combined">{{ t('model3d.panels.dataDisplay.combined') }}</option>
            </select>
          </div>
        </div>
        
        <!-- Êó∂Èó¥ÈÄâÊã©Èù¢ÊùøÔºöÊéßÂà∂Êï∞ÊçÆÂ±ïÁ§∫ÁöÑÊó∂Èó¥ÁÇπ -->
        <div class="mac-panel panel-section">
          <h3 class="panel-title">{{ t('model3d.panels.timeSelect.title') }}</h3>
          <!-- Êó∂Èó¥ÊªëÂùóÔºöÊéßÂà∂‰∏ÄÂ§©‰∏≠ÁöÑÂ∞èÊó∂ (0-23) -->
          <div class="time-slider">
            <input 
              type="range" 
              min="0" 
              max="23" 
              v-model="currentHour" 
              @input="updateTimeBasedData"
              class="mac-slider"
            >
            <!-- ÊòæÁ§∫ÂΩìÂâçÈÄâ‰∏≠ÁöÑÊó∂Èó¥ -->
            <div class="time-display">{{ formatHour(currentHour) }}</div>
          </div>
          <!-- Êó•ÊúüÁ±ªÂûãÈÄâÊã©ÔºöÂ∑•‰ΩúÊó•/‰ºëÊÅØÊó• -->
          <div class="day-select">
            <!-- activeÁ±ªÊ†πÊçÆdayTypeÁöÑÂÄºÂä®ÊÄÅÊ∑ªÂä† -->
            <button @click="setDayType('workday')" :class="{ active: dayType === 'workday' }" class="mac-button">{{ t('model3d.panels.timeSelect.workday') }}</button>
            <button @click="setDayType('weekend')" :class="{ active: dayType === 'weekend' }" class="mac-button">{{ t('model3d.panels.timeSelect.weekend') }}</button>
          </div>
        </div>
        
        <!-- ‰ΩøÁî®ËØ¥ÊòéÈù¢ÊùøÔºöÂ∏ÆÂä©Áî®Êà∑‰∫ÜËß£Êìç‰ΩúÊñπÂºè -->
        <div class="mac-panel panel-section info-section">
          <h3 class="panel-title">{{ t('model3d.panels.instructions.title') }}</h3>
          <ul class="instruction-list">
            <li>{{ t('model3d.panels.instructions.rotate') }}</li>
            <li>{{ t('model3d.panels.instructions.pan') }}</li>
            <li>{{ t('model3d.panels.instructions.zoom') }}</li>
            <li>{{ t('model3d.panels.instructions.click') }}</li>
          </ul>
        </div>
      </div>
      
      <!-- ‰∏≠Èó¥3DÊ®°ÂûãÂ±ïÁ§∫Âå∫ÔºöThree.jsÊ∏≤ÊüìÁöÑ‰∏ªË¶ÅÂå∫Âüü -->
      <div class="model-canvas-container">
        <!-- ref="modelCanvas"ÂºïÁî®DOMÂÖÉÁ¥†ÔºåÁî®‰∫éThree.jsÂàùÂßãÂåñ -->
        <div ref="modelCanvas" class="model-canvas"></div>
      </div>
      
      <!-- Âè≥‰æßÊï∞ÊçÆÈù¢ÊùøÔºöÊòæÁ§∫ÈÄâ‰∏≠ÂØπË±°ÁöÑËØ¶ÁªÜ‰ø°ÊÅØÂíåÊï∞ÊçÆÂõæË°® -->
      <div class="right-panel">
        <!-- ‰ø°ÊÅØÈù¢ÊùøÔºöÊòæÁ§∫ÈÄâ‰∏≠ÂØπË±°ÁöÑËØ¶ÁªÜ‰ø°ÊÅØ --> 
        <div class="mac-panel panel-section">
          <h3 class="panel-title">{{ t('model3d.panels.infoPanel.title') }}</h3>
          <!-- ÂΩìÊúâÈÄâ‰∏≠ÁöÑÂØπË±°Êó∂ÊòæÁ§∫ -->
          <div class="info-content" v-if="selectedObject">
            <!-- ÂØπË±°Ê†áÈ¢òÂå∫Âüü -->
            <div class="object-info-header">
              <!-- Ê†πÊçÆÂØπË±°Á±ªÂûãËÆæÁΩÆ‰∏çÂêåÈ¢úËâ≤ÁöÑÂõæÊ†á -->
              <span class="object-icon" :class="selectedObject.type">‚óè</span>
              <h4>{{ selectedObject.name }}</h4>
            </div>
            <!-- ÂØπË±°ËØ¶ÁªÜ‰ø°ÊÅØÂå∫Âüü -->
            <div class="object-info-body">
              <p><strong>{{ t('model3d.panels.infoPanel.type') }}Ôºö</strong> {{ getTypeDisplayName(selectedObject.type) }}</p>
              <!-- Êù°‰ª∂Ê∏≤ÊüìÔºöÂè™ÊúâÂΩìÂØπË±°ÊúâpositionÂ±ûÊÄßÊó∂ÊâçÊòæÁ§∫‰ΩçÁΩÆ‰ø°ÊÅØ -->
              <p v-if="selectedObject.position"><strong>{{ t('model3d.panels.infoPanel.position') }}Ôºö</strong>{{ formatPosition(selectedObject.position, selectedObject.id, selectedObject.type) }}</p>
              <!-- ÊëÑÂÉèÂ§¥ÁâπÊúâ‰ø°ÊÅØÔºöÂú®Á∫øÁä∂ÊÄÅ -->
              <p v-if="selectedObject.type === 'camera'">
                <strong>{{ t('model3d.panels.infoPanel.status') }}Ôºö</strong> <span :class="selectedObject.status ? 'status-online' : 'status-offline'">{{ selectedObject.status ? t('model3d.panels.infoPanel.online') : t('model3d.panels.infoPanel.offline') }}</span>
              </p>
              <!-- Êï∞ÊçÆËäÇÁÇπÁâπÊúâ‰ø°ÊÅØÔºöÊï∞ÂÄº -->
              <p v-if="selectedObject.type === 'data'">
                <strong>{{ t('model3d.panels.infoPanel.value') }}Ôºö</strong> {{ selectedObject.value.toFixed(2) }}
              </p>
              <!-- ÊëÑÂÉèÂ§¥ÁâπÊúâÊåâÈíÆÔºöÊü•ÁúãÊï∞ÊçÆ -->
              <button v-if="selectedObject.type === 'camera'" @click="showCameraData" class="mac-button camera-data-btn">{{ t('model3d.panels.infoPanel.viewData') }}</button>
            </div>
          </div>
          <!-- ÂΩìÊ≤°ÊúâÈÄâ‰∏≠ÂØπË±°Êó∂ÊòæÁ§∫ÁöÑÊèêÁ§∫‰ø°ÊÅØ -->
          <div class="info-content info-placeholder" v-else>
            <div class="placeholder-icon">üñ±Ô∏è</div>
            <p>{{ t('model3d.panels.infoPanel.clickToView') }}</p>
          </div>
        </div>
        <!-- Âú®‰ø°ÊÅØÈù¢Êùø‰πãÂêéÔºåÁªüËÆ°Êï∞ÊçÆÈù¢Êùø‰πãÂâçÊ∑ªÂä†Âü∫Âú∞ÊÄª‰ΩìÂπ≥Èù¢ÂõæÈù¢Êùø -->
        <div class="mac-panel panel-section">
          <h3 class="panel-title">{{ t('model3d.panels.siteplan.title', 'Âü∫Âú∞ÊÄª‰ΩìÂπ≥Èù¢Âõæ') }}</h3>
          <div class="siteplan-content">
            <!-- Âπ≥Èù¢ÂõæÂõæÂÉèÂÆπÂô® -->
            <div class="siteplan-image-container">
              <img 
                :src="siteplanType === 'normal' 
                  ? '../src/assets/site_plans/gaojing_siteplan.png' 
                  : '../src/assets/site_plans/gaojing_Satellite_plan.png'" 
                :alt="siteplanType === 'normal' ? t('model3d.panels.siteplan.normal', 'Âü∫Âú∞ÊÄª‰ΩìÂπ≥Èù¢Âõæ') : t('model3d.panels.siteplan.satellite', 'Âü∫Âú∞Âç´ÊòüÂõæ')" 
                class="siteplan-image" 
              />
              <!-- Ê∑ªÂä†ÊîæÂ§ßÊåâÈíÆ -->
              <div class="zoom-button-container">
                <button @click="toggleSitePlanFullscreen" class="zoom-button">
                  <span class="zoom-icon">üîç</span>
                </button>
              </div>
            </div>
            <!-- Âπ≥Èù¢ÂõæÊéßÂà∂ÊåâÈíÆÂå∫Âüü -->
            <div class="siteplan-controls">
              <button 
                @click="changeSiteplanType('normal')" 
                :class="{ active: siteplanType === 'normal' }" 
                class="mac-button siteplan-btn">
                {{ t('model3d.panels.siteplan.normalBtn', 'Âπ≥Èù¢Âõæ') }}
              </button>
              <button 
                @click="changeSiteplanType('satellite')" 
                :class="{ active: siteplanType === 'satellite' }" 
                class="mac-button siteplan-btn">
                {{ t('model3d.panels.siteplan.satelliteBtn', 'Âç´ÊòüÂõæ') }}
              </button>
            </div>
          </div>
        </div>
        
        <!-- ÁªüËÆ°Êï∞ÊçÆÈù¢ÊùøÔºöÊòæÁ§∫ÊÄª‰ΩìÁªüËÆ°ÊåáÊ†á -->
        <div class="mac-panel panel-section">
          <h3 class="panel-title">{{ t('model3d.panels.statistics.title', 'ÁªüËÆ°Êï∞ÊçÆÔºàÁ§∫‰æãÔºâ') }}</h3>
          
          <!-- Â∞ÜÊó•ÊúüÁ±ªÂûãÈÄâÊã©Âô® -->
          <div class="day-type-selector">
            <button 
              @click="setDayType('workday')" 
              :class="{ active: dayType === 'workday' }" 
              class="mac-button"> <!-- ‰ΩøÁî® mac-button class -->
                {{ t('model3d.panels.timeSelect.workday') }}
            </button>
            <button 
              @click="setDayType('weekend')" 
              :class="{ active: dayType === 'weekend' }" 
              class="mac-button"> <!-- ‰ΩøÁî® mac-button class -->
                {{ t('model3d.panels.timeSelect.weekend') }}
            </button>
          </div>

          <!-- stats-cards Áé∞Âú®Âè™ÂåÖÂê´ÁªüËÆ°Âç°Áâá -->
          <div class="stats-cards">
            <!-- Ë°å‰∫∫ÊÄªÊï∞Âç°Áâá -->
            <div class="stat-card">
              <div class="stat-title">{{ t('model3d.panels.statistics.pedestrianTotal', 'Ë°å‰∫∫ÊÄªÊï∞') }}</div>
              <div class="stat-value">{{ dayType === 'workday' ? getRandomNumber('pedestrian', 'workday') : getRandomNumber('pedestrian', 'weekend') }}</div>
              <div class="stat-time">{{ dayType === 'workday' ? t('model3d.panels.timeSelect.workday') : t('model3d.panels.timeSelect.weekend') }}{{ t('model3d.panels.statistics.accumulative', 'Á¥ØËÆ°') }}</div>
            </div>
            <!-- ËΩ¶ËæÜÊÄªÊï∞Âç°Áâá -->
            <div class="stat-card">
              <div class="stat-title">{{ t('model3d.panels.statistics.vehicleTotal', 'ËΩ¶ËæÜÊÄªÊï∞') }}</div>
              <div class="stat-value">{{ dayType === 'workday' ? getRandomNumber('vehicle', 'workday') : getRandomNumber('vehicle', 'weekend') }}</div>
              <div class="stat-time">{{ dayType === 'workday' ? t('model3d.panels.timeSelect.workday') : t('model3d.panels.timeSelect.weekend') }}{{ t('model3d.panels.statistics.accumulative', 'Á¥ØËÆ°') }}</div>
            </div>
            <!-- ÊëÑÂÉèÂ§¥Áä∂ÊÄÅÂç°Áâá (Â¶ÇÊûúÈúÄË¶ÅÂèØ‰ª•ÂèñÊ∂àÊ≥®Èáä) -->
            <!-- <div class="stat-card"> ... </div> -->
          </div>
        </div>
        
        <!-- ÂÆûÊó∂Êï∞ÊçÆÁõëÊéßÈù¢ÊùøÔºöÊòæÁ§∫Êï∞ÊçÆÂèòÂåñË∂ãÂäø -->
        <div class="mac-panel panel-section">
          <h3 class="panel-title">{{ t('model3d.panels.realTimeMonitor.title', 'ÂÆûÊó∂Êï∞ÊçÆÁõëÊéß(Á§∫‰æã)') }}</h3>
          <div class="realtime-data">
            <!-- ÂõæË°®ÂÆπÂô®ÔºöÈÄöËøárefÂºïÁî®ÔºåÁî®‰∫éEChartsÂàùÂßãÂåñ -->
            <div class="data-chart-container">
              <div ref="realtimeChart" class="data-chart"></div>
            </div>
            <!-- ÂõæË°®Âõæ‰æãÔºöËØ¥Êòé‰∏çÂêåÈ¢úËâ≤‰ª£Ë°®ÁöÑÊï∞ÊçÆÁ±ªÂûã -->
            <div class="chart-legend">
              <div class="legend-item">
                <span class="legend-color" style="background-color: #42b983;"></span>
                <span>{{ t('model3d.charts.pedestrianCount', 'Ë°å‰∫∫') }}</span>
              </div>
              <div class="legend-item">
                <span class="legend-color" style="background-color: #3080e8;"></span>
                <span>{{ t('model3d.charts.vehicleCount', 'ËΩ¶ËæÜ') }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ÊëÑÂÉèÂ§¥Êï∞ÊçÆÂºπÁ™óÔºöÁÇπÂáªÊëÑÂÉèÂ§¥ÁöÑ"Êü•ÁúãÊï∞ÊçÆ"ÊåâÈíÆÊó∂ÂºπÂá∫ -->
    <div v-if="showCameraModal" class="camera-modal">
      <div class="mac-modal modal-content">
        <!-- Ê®°ÊÄÅÊ°ÜÊ†áÈ¢òÊ†è -->
        <div class="modal-header">
          <h3 class="modal-title">{{ t('model3d.modal.camera.title', 'ÊëÑÂÉèÂ§¥Êï∞ÊçÆ') }} - {{ selectedObject.name }}</h3>
          <!-- ÂÖ≥Èó≠ÊåâÈíÆÔºöÁÇπÂáªÊó∂Â∞ÜshowCameraModalËÆæ‰∏∫false -->
          <button @click="showCameraModal = false" class="close-btn">&times;</button>
        </div>
        <!-- Ê®°ÊÄÅÊ°ÜÂÜÖÂÆπÂå∫ -->
        <div class="modal-body">
          <!-- Ê†áÁ≠æÈ°µÂàáÊç¢ÊåâÈíÆ -->
          <div class="camera-tabs">
            <button :class="{ active: activeTab === 'live' }" @click="activeTab = 'live'" class="mac-tab-button">{{ t('model3d.modal.camera.liveTab', 'ÊëÑÂÉèÂ§¥ÁîªÈù¢(ÂÆûÊó∂Ê†∑Âºè)') }}</button>
            <button :class="{ active: activeTab === 'mask' }" @click="activeTab = 'mask'" class="mac-tab-button">{{ t('model3d.modal.camera.maskTab', 'ÊëÑÂÉèÂ§¥MaskÂå∫ÂüüÔºàË°å‰∫∫Ê£ÄÊµãÔºâ') }}</button>
            <button :class="{ active: activeTab === 'yolov5' }" @click="activeTab = 'yolov5'" class="mac-tab-button">{{ t('model3d.modal.camera.yoloTab', 'yolov5Â§ÑÁêÜÂêéÁîªÈù¢ÔºàË°å‰∫∫Ê£ÄÊµãÔºâ') }}</button>
            <button :class="{ active: activeTab === 'data' }" @click="activeTab = 'data'" class="mac-tab-button">{{ t('model3d.modal.camera.dataTab', 'ÂéÜÂè≤Êï∞ÊçÆ(Á§∫‰æã)') }}</button>
          </div>
          
          <!-- ÂÆûÊó∂ÂõæÂÉèÊ†áÁ≠æÈ°µÂÜÖÂÆπ -->
          <div v-if="activeTab === 'live'" class="tab-content">
            <div class="live-preview">
              <!-- ÊëÑÂÉèÂ§¥ÂõæÂÉèÔºàÊ†πÊçÆmesh IDÂä†ËΩΩÂØπÂ∫îÂõæÂÉèÔºâ -->
              <img :src="getCameraImageUrl(selectedObject.id)" :alt="selectedObject.name" />
              <!-- Ê£ÄÊµã‰ø°ÊÅØÔºöÊòæÁ§∫ÂΩìÂâçÊó∂Èó¥ÂíåÈ¢ÑÂÆö‰πâÁöÑÊ£ÄÊµãÊï∞ÊçÆ -->
              <div class="detection-info">
                <p>{{ t('model3d.modal.camera.time', 'Êó∂Èó¥') }}Ôºö{{ new Date().toLocaleString() }}</p>
                <p>{{ t('model3d.modal.camera.pedestrianCount', 'Ë°å‰∫∫Êï∞Èáè') }}Ôºö{{ getCameraDetectionData(selectedObject.id).pedestrians }}</p>
                <p>{{ t('model3d.modal.camera.vehicleCount', 'ËΩ¶ËæÜÊï∞Èáè') }}Ôºö{{ getCameraDetectionData(selectedObject.id).vehicles }}</p>
                <p>{{ t('model3d.modal.camera.illegalPedestrians', 'ÈùûÊ≥ïË°å‰∫∫Êï∞ÈáèÔºàÁªøÂåñÂå∫Á¶ÅÊ≠¢ËøõÂÖ•Ôºâ') }}Ôºö{{ getCameraDetectionData(selectedObject.id).illegalPedestrians }}</p>
                <p>{{ t('model3d.modal.camera.illegalVehicles', 'ÈùûÊ≥ïÂÅúËΩ¶ËΩ¶ËæÜÊï∞ÈáèÔºàÁ¶ÅÊ≠¢ÂÅúËΩ¶Âå∫ÂüüÔºâ') }}Ôºö{{ getCameraDetectionData(selectedObject.id).illegalVehicles }}</p>
              </div>
            </div>
          </div>
          
          <!-- maskÂå∫ÂüüÊ†áÁ≠æÈ°µÂÜÖÂÆπ -->
          <div v-if="activeTab === 'mask'" class="tab-content">
            <div class="live-preview">
              <img :src="getCameraMaskAndRealImageUrl(selectedObject.id)" :alt="selectedObject.name" />
              <img :src="getCameraMaskImageUrl(selectedObject.id)" :alt="selectedObject.name" />
            </div>
          </div>
          
          <!-- yolov5ËØÜÂà´ÁîªÈù¢Ê†áÁ≠æÈ°µÂÜÖÂÆπ -->
          <div v-if="activeTab === 'yolov5'" class="tab-content">
            <div class="live-preview">
              <img :src="getCameraYolov5ImageUrl(selectedObject.id)" :alt="selectedObject.name" />
              <!-- Ê£ÄÊµã‰ø°ÊÅØÔºöÊòæÁ§∫ÂΩìÂâçÊó∂Èó¥ÂíåÈ¢ÑÂÆö‰πâÁöÑÊ£ÄÊµãÊï∞ÊçÆ -->
              <div class="detection-info">
                <p>{{ t('model3d.modal.camera.time', 'Êó∂Èó¥') }}Ôºö{{ new Date().toLocaleString() }}</p>
                <p>{{ t('model3d.modal.camera.pedestrianCount', 'Ë°å‰∫∫Êï∞Èáè') }}Ôºö{{ getCameraDetectionData(selectedObject.id).pedestrians }}</p>
                <p>{{ t('model3d.modal.camera.vehicleCount', 'ËΩ¶ËæÜÊï∞Èáè') }}Ôºö{{ getCameraDetectionData(selectedObject.id).vehicles }}</p>
                <p>{{ t('model3d.modal.camera.illegalPedestrians', 'ÈùûÊ≥ïË°å‰∫∫Êï∞ÈáèÔºàÁªøÂåñÂå∫Á¶ÅÊ≠¢ËøõÂÖ•Ôºâ') }}Ôºö{{ getCameraDetectionData(selectedObject.id).illegalPedestrians }}</p>
                <p>{{ t('model3d.modal.camera.illegalVehicles', 'ÈùûÊ≥ïÂÅúËΩ¶ËΩ¶ËæÜÊï∞ÈáèÔºàÁ¶ÅÊ≠¢ÂÅúËΩ¶Âå∫ÂüüÔºâ') }}Ôºö{{ getCameraDetectionData(selectedObject.id).illegalVehicles }}</p>
              </div>
            </div>
          </div>

          <!-- ÂéÜÂè≤Êï∞ÊçÆÊ†áÁ≠æÈ°µÂÜÖÂÆπ -->
          <div v-if="activeTab === 'data'" class="tab-content">
            <!-- ÂõæË°®ÂÆπÂô®ÔºöÈÄöËøárefÂºïÁî®ÔºåÁî®‰∫éEChartsÂàùÂßãÂåñ -->
            <div id="cameraDataChart" class="camera-chart"></div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Ê∑ªÂä†ÂÖ®Â±èÊü•ÁúãÊ®°ÊÄÅÊ°Ü -->
    <div v-if="showSitePlanModal" class="siteplan-modal">
      <div class="modal-content siteplan-modal-content">
        <div class="modal-header">
          <h3 class="modal-title">{{ siteplanType === 'normal' ? t('model3d.panels.siteplan.normal', 'Âü∫Âú∞ÊÄª‰ΩìÂπ≥Èù¢Âõæ') : t('model3d.panels.siteplan.satellite', 'Âü∫Âú∞Âç´ÊòüÂõæ') }}</h3>
          <button @click="showSitePlanModal = false" class="close-btn">&times;</button>
        </div>
        <div class="modal-body siteplan-modal-body">
          <img 
            :src="siteplanType === 'normal' 
              ? '../src/assets/site_plans/gaojing_siteplan.png' 
              : '../src/assets/site_plans/gaojing_Satellite_plan.png'" 
            :alt="siteplanType === 'normal' ? t('model3d.panels.siteplan.normal', 'Âü∫Âú∞ÊÄª‰ΩìÂπ≥Èù¢Âõæ') : t('model3d.panels.siteplan.satellite', 'Âü∫Âú∞Âç´ÊòüÂõæ')"
            class="fullscreen-image" 
          />
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
// ÂºïÂÖ•ÂøÖË¶ÅÁöÑVueÁªÑ‰ª∂ÂíåÁ¨¨‰∏âÊñπÂ∫ì
import { ref, onMounted, onBeforeUnmount, watch, computed, inject, reactive } from 'vue';
// Three.jsÔºö3DÊ∏≤ÊüìÂ∫ì
import * as THREE from 'three';
// OrbitControlsÔºöThree.jsÁöÑÊëÑÂÉèÊú∫ÊéßÂà∂Êâ©Â±ïÔºåÂÆûÁé∞Èº†Ê†á‰∫§‰∫í
import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';
// TWEENÔºöÂä®ÁîªËøáÊ∏°Â∫ìÔºåÁî®‰∫éÂπ≥ÊªëËøáÊ∏°
import TWEEN from '@tweenjs/tween.js';
// EChartsÔºöÂõæË°®Â∫ìÔºåÁî®‰∫éÊï∞ÊçÆÂèØËßÜÂåñ
import * as echarts from 'echarts';
// Vue RouterÁöÑË∑ØÁî±Ëé∑ÂèñÈí©Â≠ê
import { useRoute } from 'vue-router';
// Âú®ËÑöÊú¨ÂºÄÂ§¥Ê∑ªÂä†GLTFLoaderÂØºÂÖ•
import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';
// Ê∑ªÂä†vue-i18nÊîØÊåÅ
import { useI18n } from 'vue-i18n';

// ‰ªéApp.vueÊ≥®ÂÖ•isModel3DPage
// Ëøô‰∏™ÂÄºÂÜ≥ÂÆöÂΩìÂâçÊòØÂê¶Âú®3DÊ®°ÂûãÈ°µÈù¢ÔºåÁî®‰∫éÂ∫îÁî®ÁâπÊÆäÊ†∑Âºè
// ÂèÇÊï∞2 falseÊòØÈªòËÆ§ÂÄºÔºåÂΩìÊ≤°ÊúâÊèê‰æõÂÄºÊó∂‰ΩøÁî®
const isModel3DPage = inject('isModel3DPage', false);
// Ëé∑Âèñi18nÂÆû‰æã
const { t } = useI18n();

// === Áä∂ÊÄÅÂèòÈáèÂå∫Âüü ===
// Three.jsÊ∏≤ÊüìÁöÑcanvasÂÆπÂô®ÂºïÁî®
const modelCanvas = ref(null);
// ÂÆûÊó∂ÂõæË°®ÂÆπÂô®ÂºïÁî®
const realtimeChart = ref(null);
// ÂõæÂ±ÇÊòæÁ§∫Áä∂ÊÄÅ
const layers = ref({
  buildings: true,  // Âª∫Á≠ëÁâ©ÂõæÂ±Ç
  roads: true,      // ÈÅìË∑ØÂõæÂ±Ç
  cameras: true,    // ÊëÑÂÉèÂ§¥ÂõæÂ±Ç
  visionLines: false, // ÊëÑÂÉèÂ§¥ËßÜÁ∫øÁ∫øÊÆµÂõæÂ±Ç - ÈªòËÆ§ÂÖ≥Èó≠
  visionPlane: false, // ÊëÑÂÉèÂ§¥ËßÜÈáéÂπ≥Èù¢ÂõæÂ±Ç - ÈªòËÆ§ÂÖ≥Èó≠
  data: false        // Êï∞ÊçÆÂõæÂ±Ç - ÈªòËÆ§ÂÖ≥Èó≠
});
// ÈÄâÊã©ÁöÑÊï∞ÊçÆÁ±ªÂûãÔºönone(Êó†Êï∞ÊçÆ)/pedestrian(Ë°å‰∫∫)/vehicle(ËΩ¶ËæÜ)/combined(ÁªºÂêà)
const selectedData = ref('none');
// ÂΩìÂâçÈÄâÊã©ÁöÑÂ∞èÊó∂(0-23)ÔºåÈªòËÆ§‰∏≠Âçà12ÁÇπ
const currentHour = ref(12); 
// Êó•ÊúüÁ±ªÂûãÔºöworkday(Â∑•‰ΩúÊó•)/weekend(‰ºëÊÅØÊó•)
const dayType = ref('workday');
// ÊòØÂê¶ÂêØÁî®ËΩ®ÈÅìÊéßÂà∂
const orbitControlsEnabled = ref(true);
// ÊòØÂê¶ÊòæÁ§∫Á∫øÊ°ÜÊ®°Âºè
const isWireframe = ref(false);
// ÂΩìÂâçÈÄâ‰∏≠ÁöÑÂØπË±°
const selectedObject = ref(null);
// ÊòØÂê¶ÊòæÁ§∫ÊëÑÂÉèÂ§¥Êï∞ÊçÆÂºπÁ™ó
const showCameraModal = ref(false);
// ÂΩìÂâçÊøÄÊ¥ªÁöÑÊ†áÁ≠æÈ°µÔºölive(ÂÆûÊó∂ÂõæÂÉè)/data(ÂéÜÂè≤Êï∞ÊçÆ)
const activeTab = ref('live');
// ÂÆûÊó∂ÂõæË°®ÂÆû‰æãÔºàÈùûÂìçÂ∫îÂºèÔºâ
let realtimeChartInstance = null;

// === Three.jsÁõ∏ÂÖ≥ÂèòÈáè ===
// Ëøô‰∫õÂèòÈáè‰∏çÊòØÂìçÂ∫îÂºèÁöÑÔºåÂõ†‰∏∫ÂÆÉ‰ª¨‰∏çÈúÄË¶ÅËß¶ÂèëUIÊõ¥Êñ∞
let scene, camera, renderer, controls, raycaster, mouse;
// ‰∏çÂêåÁ±ªÂûãÁâ©‰ΩìÁöÑÁªÑÔºåÊñπ‰æøÁªü‰∏ÄÊéßÂà∂
let buildingsGroup, roadsGroup, camerasGroup, dataGroup, visionLinesGroup, visionPlaneGroup;
// ÊâÄÊúâÂèØ‰∫§‰∫íÁöÑÁΩëÊ†ºÂØπË±°Êï∞ÁªÑ
let allMeshes = [];

// === ËæÖÂä©ÂáΩÊï∞Âå∫Âüü ===

/**
 * ÁîüÊàêÊåáÂÆöËåÉÂõ¥ÂÜÖÁöÑÈöèÊú∫Êï¥Êï∞
 * @param {number} min - ÊúÄÂ∞èÂÄº
 * @param {number} max - ÊúÄÂ§ßÂÄº
 * @returns {number} ÁîüÊàêÁöÑÈöèÊú∫Êï¥Êï∞
 */
/**
 * Ê†πÊçÆÁ±ªÂûãÂíåÊó•ÊúüËøîÂõûÂØπÂ∫îÁöÑÊï∞ÊçÆÊÄªÂíå
 * @param {string} type - Êï∞ÊçÆÁ±ªÂûãÔºö'pedestrian'(Ë°å‰∫∫)Êàñ'vehicle'(ËΩ¶ËæÜ)
 * @param {string} day - Êó•ÊúüÁ±ªÂûãÔºö'workday'(Â∑•‰ΩúÊó•)Êàñ'weekend'(‰ºëÊÅØÊó•)
 * @returns {number} ËøîÂõûÂØπÂ∫îÁ±ªÂûãÂíåÊó•ÊúüÁöÑÊï∞ÊçÆÊÄªÂíå
 */
function getRandomNumber(type, day) {
  // Ê®°Êãü‰∫∫ÊµÅÈáèÊï∞ÊçÆ
  const pedestrianData = {
    workday: [3, 6, 12, 9, 6, 4, 10, 18, 14, 10, 8, 5, 4, 6, 10, 20, 28, 22, 14, 10, 8, 5, 4, 3],
    weekend: [2, 4, 5, 7, 9, 12, 15, 18, 20, 18, 16, 18, 20, 22, 24, 20, 22, 30, 28, 24, 16, 10, 6, 4]
  };

  // Ê®°ÊãüËΩ¶ÊµÅÈáèÊï∞ÊçÆ
  const vehicleData = {
    workday: [2, 3, 6, 5, 3, 2, 5, 10, 8, 6, 5, 3, 2, 3, 5, 12, 16, 14, 8, 6, 5, 3, 2, 2],
    weekend: [1, 2, 3, 4, 5, 6, 8, 10, 12, 10, 9, 10, 12, 14, 16, 14, 16, 20, 18, 16, 12, 8, 5, 3]
  };
  
  // Ê†πÊçÆÁ±ªÂûãÂíåÊó•ÊúüËøîÂõûÂØπÂ∫îÁöÑÊï∞ÊçÆÊÄªÂíå
  if (type === 'pedestrian') {
    return pedestrianData[day].reduce((sum, value) => sum + value, 0);
  } else if (type === 'vehicle') {
    return vehicleData[day].reduce((sum, value) => sum + value, 0);
  }
  
  return 0;
}

/**
 * Ëé∑ÂèñÂØπË±°Á±ªÂûãÁöÑ‰∏≠ÊñáÊòæÁ§∫ÂêçÁß∞
 * @param {string} type - ÂØπË±°Á±ªÂûãÔºöbuilding/road/camera/data
 * @returns {string} ÂØπÂ∫îÁöÑ‰∏≠ÊñáÂêçÁß∞
 */
function getTypeDisplayName(type) {
  const typeMap = {
    'building': t('model3d.objectTypes.building', 'Âª∫Á≠ëÁâ©'),
    'road': t('model3d.objectTypes.road', 'ÈÅìË∑Ø'),
    'camera': t('model3d.objectTypes.camera', 'ÊëÑÂÉèÂ§¥'),
    'data': t('model3d.objectTypes.data', 'Êï∞ÊçÆËäÇÁÇπ')
  };
  return typeMap[type] || type;
}

/**
 * Ê†ºÂºèÂåñÂ∞∫ÂØ∏‰ø°ÊÅØ‰∏∫ÊòìËØªÁöÑÂ≠óÁ¨¶‰∏≤
 * @param {Object} dim - Â∞∫ÂØ∏ÂØπË±°ÔºåÂåÖÂê´width/depth/heightÂ±ûÊÄß
 * @returns {string} Ê†ºÂºèÂåñÂêéÁöÑÂ∞∫ÂØ∏Â≠óÁ¨¶‰∏≤
 */
function formatDimension(dim) {
  if (!dim) return '';
  return `${dim.width}m √ó ${dim.depth}m √ó ${dim.height}m`;
}

/**
 * ÁîüÊàêÊëÑÂÉèÂ§¥ÁöÑÊèèËø∞ÊÄßÂêçÁß∞
 * @param {string} originalName - ÂéüÂßãÂêçÁß∞ÔºåÈÄöÂ∏∏ÊòØmeshÂêçÁß∞
 * @returns {string} ÁîüÊàêÁöÑÊèèËø∞ÊÄßÂêçÁß∞
 */
function generateCameraName(originalName) {
  // Â¶ÇÊûúÂéüÂßãÂêçÁß∞Â≠òÂú®
  if (originalName) {
    // È¶ñÂÖàÂ∞ùËØï‰ΩøÁî®ÂõΩÈôÖÂåñÂêçÁß∞Êò†Â∞Ñ
    if (t(`model3d.names.cameras.${originalName}`, null)) {
      return t(`model3d.names.cameras.${originalName}`);
    }
    
    // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞Êò†Â∞ÑÔºåÊèêÂèñÊï∞Â≠óÈÉ®ÂàÜ
    const match = originalName.match(/\d+/);
    if (match) {
      const num = match[0];
      return t('model3d.cameraName', {num: num});
    }
    return originalName;
  }
  
  // Â¶ÇÊûúÊ≤°ÊúâÂéüÂßãÂêçÁß∞ÔºåËøîÂõûÈªòËÆ§ÂêçÁß∞
  return t('model3d.defaultCameraName');
}

/**
 * ÁîüÊàêÂª∫Á≠ëÁâ©ÁöÑÊèèËø∞ÊÄßÂêçÁß∞
 * @param {string} originalName - ÂéüÂßãÂêçÁß∞ÔºåÈÄöÂ∏∏ÊòØmeshÂêçÁß∞
 * @returns {string} ÁîüÊàêÁöÑÊèèËø∞ÊÄßÂêçÁß∞
 */
 function generateBuildingName(originalName) {
  // Â¶ÇÊûúÂéüÂßãÂêçÁß∞Â≠òÂú®
  if (originalName) {
    // È¶ñÂÖàÂ∞ùËØï‰ΩøÁî®ÂõΩÈôÖÂåñÂêçÁß∞Êò†Â∞Ñ
    if (t(`model3d.names.buildings.${originalName}`, null)) {
      return t(`model3d.names.buildings.${originalName}`);
    }
    
    // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞Êò†Â∞ÑÔºåÊèêÂèñÊï∞Â≠óÈÉ®ÂàÜ
    const match = originalName.match(/\d+/);
    if (match) {
      const num = match[0];
      return t('model3d.buildingName', {num: num}, `Âª∫Á≠ëÁâ©${num}Âè∑`);
    }
    return originalName;
  }
  
  // Â¶ÇÊûúÊ≤°ÊúâÂéüÂßãÂêçÁß∞ÔºåËøîÂõûÈªòËÆ§ÂêçÁß∞
  return t('model3d.defaultBuildingName', 'Êú™ÂëΩÂêçÂª∫Á≠ëÁâ©');
}


// === Three.jsÂàùÂßãÂåñÂáΩÊï∞ ===

/**
 * ÂàùÂßãÂåñThree.jsÂú∫ÊôØÂíåÁõ∏ÂÖ≥ÁªÑ‰ª∂
 * ËøôÊòØÊï¥‰∏™3DÊ®°ÂûãÁöÑÊ†∏ÂøÉÂàùÂßãÂåñÂáΩÊï∞
 */
function initThreeJS() {
  console.log("ÂàùÂßãÂåñThree.jsÂú∫ÊôØ");
  console.log("CanvasÂÖÉÁ¥†Â≠òÂú®:", !!modelCanvas.value);
  
  // ÂàõÂª∫Âú∫ÊôØÂØπË±°
  scene = new THREE.Scene();
  // ËÆæÁΩÆËÉåÊôØËâ≤‰∏∫ÁôΩËâ≤
  scene.background = new THREE.Color(0xFFFFFF);
  
  try {
    // ÂàõÂª∫ÈÄèËßÜÁõ∏Êú∫
    // ÂèÇÊï∞: ËßÜÂú∫ËßíÂ∫¶, ÂÆΩÈ´òÊØî, ËøëË£ÅÂâ™Èù¢, ËøúË£ÅÂâ™Èù¢
    camera = new THREE.PerspectiveCamera(
      60,
      window.innerWidth / window.innerHeight,
      0.1,
      1000
    );
    // ËÆæÁΩÆÁõ∏Êú∫ÂàùÂßã‰ΩçÁΩÆ
    camera.position.set(50, 50, 50);
    // ËÆ©Áõ∏Êú∫ÁúãÂêëÂéüÁÇπ(0,0,0)
    camera.lookAt(0, 0, 0);
    
    // ÂàõÂª∫WebGLÊ∏≤ÊüìÂô®
    renderer = new THREE.WebGLRenderer({ 
      antialias: true,              // ÊäóÈîØÈΩø
      alpha: true,                  // ÊîØÊåÅÈÄèÊòé
      powerPreference: 'high-performance' // ÊÄßËÉΩ‰ºòÂÖà
    });
    // ÈÄÇÈÖçËÆæÂ§áÂÉèÁ¥†ÊØî‰æãÔºåÁ°Æ‰øùÈ´òDPIËÆæÂ§á‰∏äÊòæÁ§∫Ê∏ÖÊô∞
    renderer.setPixelRatio(window.devicePixelRatio);
    // ËÆæÁΩÆÊ∏≤ÊüìÂ∞∫ÂØ∏‰∏∫Á™óÂè£Â§ßÂ∞è
    renderer.setSize(window.innerWidth, window.innerHeight);
    // ÂêØÁî®Èò¥ÂΩ±Ê∏≤Êüì
    renderer.shadowMap.enabled = true;
    // ËÆæÁΩÆÈò¥ÂΩ±Á±ªÂûã‰∏∫ÊüîÂíåPCFÈò¥ÂΩ±
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    
    // ËÆ∞ÂΩïÂ∞∫ÂØ∏‰ø°ÊÅØÔºå‰æø‰∫éË∞ÉËØï
    console.log("Á™óÂè£Â∞∫ÂØ∏:", window.innerWidth, window.innerHeight);
    console.log("CanvasÂ∞∫ÂØ∏:", renderer.domElement.width, renderer.domElement.height);
    
    // Â∞ÜÊ∏≤ÊüìÂô®ÁöÑcanvasÂÖÉÁ¥†Ê∑ªÂä†Âà∞DOM
    if (modelCanvas.value) {
      // Ê∏ÖÈô§Â∑≤ÊúâÂÜÖÂÆπ
      while (modelCanvas.value.firstChild) {
        modelCanvas.value.removeChild(modelCanvas.value.firstChild);
      }
      // Ê∑ªÂä†Three.jsÊ∏≤ÊüìÂô®ÂàõÂª∫ÁöÑcanvasÂà∞DOM
      modelCanvas.value.appendChild(renderer.domElement);
      console.log("Ê∏≤ÊüìÂô®DOMÂÖÉÁ¥†Â∑≤Ê∑ªÂä†Âà∞ÁîªÂ∏É");
    } else {
      console.error("modelCanvasÂÖÉÁ¥†‰∏çÂ≠òÂú®");
      return;
    }
    
    // Ê∑ªÂä†ËΩ®ÈÅìÊéßÂà∂Âô®ÔºåÂÆûÁé∞Èº†Ê†á‰∫§‰∫í
    controls = new OrbitControls(camera, renderer.domElement);
    // ÂêØÁî®ÈòªÂ∞ºÊïàÊûúÔºå‰ΩøÁõ∏Êú∫ÁßªÂä®Êõ¥Âπ≥Êªë
    controls.enableDamping = true;
    // ËÆæÁΩÆÈòªÂ∞ºÁ≥ªÊï∞
    controls.dampingFactor = 0.05;
    
    // Ê∑ªÂä†ÁéØÂ¢ÉÂÖâÔºö‰ªéÂêÑ‰∏™ÊñπÂêëÁÖßÂ∞ÑÁöÑÊüîÂíåÂÖâÊ∫ê
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambientLight);
    
    // Ê∑ªÂä†Âπ≥Ë°åÂÖâÔºöÊ®°ÊãüÂ§™Èò≥ÂÖâÁöÑÂÆöÂêëÂÖâÊ∫ê
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    // ËÆæÁΩÆÂÖâÊ∫ê‰ΩçÁΩÆ
    directionalLight.position.set(50, 200, 100);
    // ÂÖÅËÆ∏ÂÖâÊ∫êÊäïÂ∞ÑÈò¥ÂΩ±
    directionalLight.castShadow = true;
    scene.add(directionalLight);
    
    // ÂàõÂª∫‰∏çÂêåÁ±ªÂûãÁâ©‰ΩìÁöÑÂàÜÁªÑÔºåÊñπ‰æøÁªü‰∏ÄÁÆ°ÁêÜ
    buildingsGroup = new THREE.Group(); // Âª∫Á≠ëÁâ©ÁªÑ
    roadsGroup = new THREE.Group();     // ÈÅìË∑ØÁªÑ
    camerasGroup = new THREE.Group();   // ÊëÑÂÉèÂ§¥ÁªÑ
    dataGroup = new THREE.Group();      // Êï∞ÊçÆÁªÑ
    visionLinesGroup = new THREE.Group();  // ÊëÑÂÉèÂ§¥ËßÜÁ∫øÁ∫øÊÆµÁªÑ
    visionPlaneGroup = new THREE.Group();  // ÊëÑÂÉèÂ§¥ËßÜÈáéÂπ≥Èù¢ÁªÑ
    
    // Â∞ÜÂàÜÁªÑÊ∑ªÂä†Âà∞Âú∫ÊôØ
    scene.add(buildingsGroup);
    scene.add(roadsGroup);
    scene.add(camerasGroup);
    scene.add(dataGroup);
    scene.add(visionLinesGroup);
    scene.add(visionPlaneGroup);
    
    // ÂàùÂßãÂåñÂ∞ÑÁ∫øÊäïÂ∞ÑÂô®ÔºåÁî®‰∫éÊ£ÄÊµãÈº†Ê†áÁÇπÂáªÁöÑÁâ©‰Ωì
    raycaster = new THREE.Raycaster();
    // ÂàùÂßãÂåñÈº†Ê†áÂùêÊ†áÔºåÁî®‰∫éÂ∞ÑÁ∫øÊäïÂ∞ÑËÆ°ÁÆó
    mouse = new THREE.Vector2();
    
    // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂ÁõëÂê¨Âô®
    renderer.domElement.addEventListener('click', onCanvasClick);
    
    // ÂàõÂª∫Á§æÂå∫Ê®°ÂûãÂÜÖÂÆπÔºöÂú∞Èù¢„ÄÅÂª∫Á≠ëÁâ©„ÄÅÈÅìË∑ØÁ≠â
    createCommunityModel();
    
    // ÂêØÂä®Âä®ÁîªÂæ™ÁéØÔºåÂÆûÁé∞ÊåÅÁª≠Ê∏≤ÊüìÂíå‰∫§‰∫í
    animate();
    
    // ÁõëÂê¨Á™óÂè£Â§ßÂ∞èÂèòÂåñÔºåË∞ÉÊï¥Ê∏≤ÊüìÂ∞∫ÂØ∏
    window.addEventListener('resize', onWindowResize);
  } catch (error) {
    console.error("Three.jsÂàùÂßãÂåñÂ§±Ë¥•:", error);
  }
}

/**
 * ÂàùÂßãÂåñÂÆûÊó∂Êï∞ÊçÆÂõæË°®
 * ‰ΩøÁî®EChartsÂàõÂª∫Ë°å‰∫∫ÂíåËΩ¶ËæÜÊï∞ÈáèÁöÑÂÆûÊó∂ÂèòÂåñÂõæË°®
 */
function initRealtimeChart() {
  if (!realtimeChart.value) return;
  
  // Â¶ÇÊûúÂ∑≤ÁªèÂ≠òÂú®ÂÆû‰æãÔºåÂÖàÈîÄÊØÅ
  if (realtimeChartInstance) {
    realtimeChartInstance.dispose();
    realtimeChartInstance = null;
  }
  
  try {
    // ÂàùÂßãÂåñEChartsÂÆû‰æã
    realtimeChartInstance = echarts.init(realtimeChart.value);
    
    // ÁîüÊàêÊï∞ÊçÆÁÇπ
    const now = new Date();
    const timePoints = [];
    const pedestrianData = [];
    const vehicleData = [];
    
    // ÁîüÊàêÊúÄËøë30ÂàÜÈíüÁöÑÊï∞ÊçÆÔºàÊØèÂàÜÈíü‰∏Ä‰∏™ÁÇπÔºâ
    for (let i = 0; i < 30; i++) {
      // ËÆ°ÁÆóÊó∂Èó¥ÁÇπ
      const time = new Date(now.getTime() - (29 - i) * 60 * 1000);
      const timeStr = `${time.getHours().toString().padStart(2, '0')}:${time.getMinutes().toString().padStart(2, '0')}`;
      timePoints.push(timeStr);
      
      // Ê†πÊçÆ‰∏ÄÂ§©‰∏≠ÁöÑÊó∂ÊÆµÁîüÊàê‰∏çÂêåÁöÑÂü∫Á°ÄÊï∞ÊçÆ
      const hourOfDay = time.getHours();
      let pedestrianBase, vehicleBase;
      
      // Ê®°Êãü‰∏çÂêåÊó∂ÊÆµÁöÑÊï∞ÊçÆÊ≥¢Âä®
      if (hourOfDay >= 7 && hourOfDay <= 9) { // Êó©È´òÂ≥∞
        pedestrianBase = 40;
        vehicleBase = 20;
      } else if (hourOfDay >= 17 && hourOfDay <= 19) { // ÊôöÈ´òÂ≥∞
        pedestrianBase = 50;
        vehicleBase = 25;
      } else if (hourOfDay >= 12 && hourOfDay <= 14) { // ÂçàÈ§êÊó∂Èó¥
        pedestrianBase = 30;
        vehicleBase = 15;
      } else if (hourOfDay >= 22 || hourOfDay <= 5) { // Ê∑±Â§ú
        pedestrianBase = 10;
        vehicleBase = 5;
      } else { // ÂÖ∂‰ªñÊó∂Èó¥
        pedestrianBase = 20;
        vehicleBase = 10;
      }
      
      // Âú®Âü∫Á°ÄÂÄº‰∏äÊ∑ªÂä†ÈöèÊú∫Ê≥¢Âä®Ôºà30%‰ª•ÂÜÖÔºâ
      pedestrianData.push(Math.floor(pedestrianBase + Math.random() * pedestrianBase * 0.3));
      vehicleData.push(Math.floor(vehicleBase + Math.random() * vehicleBase * 0.3));
    }
    
    // ËÆæÁΩÆEChartsÈÖçÁΩÆÈÄâÈ°π
    const option = {
      grid: {
        top: 10,
        right: 10,
        bottom: 20,
        left: 40,
        containLabel: true
      },
      tooltip: {
        trigger: 'axis',
        formatter: function(params) {
          let result = params[0].name + '<br/>';
          params.forEach(param => {
            const marker = `<span style="display:inline-block;margin-right:5px;border-radius:50%;width:10px;height:10px;background-color:${param.color};"></span>`;
            result += marker + param.seriesName + ': ' + param.value + '<br/>';
          });
          return result;
        }
      },
      xAxis: {
        type: 'category',
        data: timePoints,
        axisLabel: {
          interval: 4,
          fontSize: 10
        }
      },
      yAxis: {
        type: 'value',
        splitLine: {
          show: true,
          lineStyle: {
            type: 'dashed'
          }
        }
      },
      series: [
        // Ë°å‰∫∫Êï∞ÊçÆÁ∫ø
        {
          name: 'Ë°å‰∫∫',
          type: 'line',
          data: pedestrianData,
          smooth: true,
          showSymbol: false,
          lineStyle: {
            width: 2,
            color: '#42b983'
          },
          areaStyle: {
            color: {
              type: 'linear',
              x: 0,
              y: 0,
              x2: 0,
              y2: 1,
              colorStops: [
                { offset: 0, color: 'rgba(66, 185, 131, 0.5)' },
                { offset: 1, color: 'rgba(66, 185, 131, 0.1)' }
              ]
            }
          }
        },
        // ËΩ¶ËæÜÊï∞ÊçÆÁ∫ø
        {
          name: 'ËΩ¶ËæÜ',
          type: 'line',
          data: vehicleData,
          smooth: true,
          showSymbol: false,
          lineStyle: {
            width: 2,
            color: '#3080e8'
          },
          areaStyle: {
            color: {
              type: 'linear',
              x: 0,
              y: 0,
              x2: 0,
              y2: 1,
              colorStops: [
                { offset: 0, color: 'rgba(48, 128, 232, 0.5)' },
                { offset: 1, color: 'rgba(48, 128, 232, 0.1)' }
              ]
            }
          }
        }
      ]
    };
    
    // Â∫îÁî®ÈÖçÁΩÆÔºåÁîüÊàêÂõæË°®
    realtimeChartInstance.setOption(option);
  } catch (e) {
    console.error("ÂõæË°®ÂàùÂßãÂåñÂ§±Ë¥•:", e);
  }
}

/**
 * ÂàõÂª∫Á§æÂå∫Ê®°ÂûãÁöÑ‰∏ªÂáΩÊï∞
 * ‰ªépublicÊñá‰ª∂Â§πÂä†ËΩΩGLTFÊ®°Âûã
 */
function createCommunityModel() {

  console.log("ÂºÄÂßãÂä†ËΩΩÂü∫Á°ÄGLTFÊ®°Âûã");

  // Ëé∑ÂèñCDNÂü∫Á°ÄË∑ØÂæÑ
  const cdnBase = 'https://fidmrvwmxwnqcvtyzyjk.supabase.co/storage/v1/object/public/smart-community-pics-models/';
  console.log("‰ΩøÁî®CDNÂü∫Á°ÄË∑ØÂæÑ:", cdnBase);

  // Â¢ûÂº∫Âú∫ÊôØÂÖâÁÖß - Ëß£ÂÜ≥Ê®°ÂûãÈªëËâ≤ÈóÆÈ¢ò
  // ÁßªÈô§‰πãÂâçÁöÑÁÅØÂÖâÔºåÈÅøÂÖçÈáçÂ§ç
  scene.children = scene.children.filter(child => 
    !(child instanceof THREE.AmbientLight || 
      child instanceof THREE.DirectionalLight || 
      child instanceof THREE.HemisphereLight));
  
  // Ê∑ªÂä†Âº∫ÁéØÂ¢ÉÂÖâ
  const ambientLight = new THREE.AmbientLight(0xffffff, 1.5);
  scene.add(ambientLight);
  
  // Ê∑ªÂä†Â§ö‰∏™ÊñπÂêëÂÖâ‰ª•Á°Æ‰øùÊ®°ÂûãÂêÑ‰∏™Èù¢ÈÉΩÊúâÂÖâÁÖß
  const directionalLight1 = new THREE.DirectionalLight(0xffffff, 1.2);
  directionalLight1.position.set(50, 200, 100);
  directionalLight1.castShadow = true;
  scene.add(directionalLight1);
  
  const directionalLight2 = new THREE.DirectionalLight(0xffffff, 1.0);
  directionalLight2.position.set(-50, 200, -100);
  directionalLight2.castShadow = true;
  scene.add(directionalLight2);
  
  // Ê∑ªÂä†ÂçäÁêÉÂÖâ
  const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 1.0);
  scene.add(hemiLight);
  
  // ÂàõÂª∫GLTFÂä†ËΩΩÂô®
  const loader = new GLTFLoader();
  
  // Âä†ËΩΩËøõÂ∫¶ÁÆ°ÁêÜ
  const loadingManager = new THREE.LoadingManager();
  loadingManager.onStart = (url) => console.log(`ÂºÄÂßãÂä†ËΩΩ: ${url}`);
  loadingManager.onProgress = (url, loaded, total) => {
    console.log(`Âä†ËΩΩËøõÂ∫¶Ôºö${Math.round(loaded/total*100)}% (${url})`);
  };
  loadingManager.onError = (url) => console.error(`Âä†ËΩΩÂá∫ÈîôÔºö${url}`);
  loader.manager = loadingManager;
  
  // 1. Âä†ËΩΩÂú∞Èù¢Ê®°Âûã
  loader.load(`${cdnBase}/ground.gltf`, (gltf) => {
    console.log("Âú∞Èù¢Ê®°ÂûãÂä†ËΩΩÊàêÂäü", gltf);
    
    const ground = gltf.scene;
    ground.traverse((child) => {
      if (child.isMesh) {
        child.receiveShadow = true;
        
        // ‰øÆÊîπÂú∞Èù¢ÊùêË¥® - Ëß£ÂÜ≥ÂÖ®ÈªëÈóÆÈ¢ò
        if (child.material) {
          // ÂàõÂª∫Êñ∞ÁöÑÊùêË¥®ÊõøÊç¢ÂéüÊúâÂÖ®ÈªëÊùêË¥®
          child.material = new THREE.MeshStandardMaterial({
            color: 0x8bc34a,        // ÁªøËâ≤Âú∞Èù¢
            roughness: 0.8,          // ËæÉÈ´òÁ≤óÁ≥ôÂ∫¶
            metalness: 0.1,          // ‰ΩéÈáëÂ±ûÊÑü
            side: THREE.DoubleSide   // ÂèåÈù¢Ê∏≤Êüì
          });
          child.material.needsUpdate = true;
        }
        
        child.userData = {
          type: 'ground',
          name: 'Âú∞Èù¢',
          selectable: false
        };
      }
    });
    
    
    scene.add(ground);
    console.log("Âú∞Èù¢Ê®°ÂûãÂ∑≤Ê∑ªÂä†Âà∞Âú∫ÊôØ");
    
  }, undefined, (error) => {
    console.error('Âä†ËΩΩÂú∞Èù¢Ê®°ÂûãÂ§±Ë¥•:', error);
    // ‰∏çÂÜç‰ΩøÁî®Â§áÁî®Âú∞Èù¢ÂàõÂª∫ÊñπÊ≥ï
  });
  
  // 2. Âä†ËΩΩÂª∫Á≠ëÁâ©Ê®°Âûã
  loader.load(`${cdnBase}/building.gltf`, (gltf) => {
    console.log("Âª∫Á≠ëÁâ©Ê®°ÂûãÂä†ËΩΩÊàêÂäü");
    
    const buildings = gltf.scene;
    let hasMeshes = false;
    
    buildings.traverse(child => {
      if (child.isMesh) {
        hasMeshes = true;
        child.castShadow = true;
        child.receiveShadow = true;
        
        // ‰øÆÊîπÊùêË¥®‰ª•Ëß£ÂÜ≥ÈªëËâ≤ÈóÆÈ¢ò
        if (child.material) {
          if (Array.isArray(child.material)) {
            child.material.forEach(material => {
              material.side = THREE.DoubleSide;
              material.metalness = 0.1;
              material.roughness = 0.8;
              material.needsUpdate = true;
              
              // Â¶ÇÊûúÊùêË¥®ÊòØÈªëËâ≤ÔºåÊõ¥Êîπ‰∏∫ÊµÖÁÅ∞Ëâ≤
              if (material.color && material.color.r === 0 && 
                  material.color.g === 0 && material.color.b === 0) {
                material.color.set(0xcccccc);
              }
            });
          } else {
            child.material.side = THREE.DoubleSide;
            child.material.metalness = 0.1;
            child.material.roughness = 0.8;
            child.material.needsUpdate = true;
            
            // Â¶ÇÊûúÊùêË¥®ÊòØÈªëËâ≤ÔºåÊõ¥Êîπ‰∏∫ÊµÖÁÅ∞Ëâ≤
            if (child.material.color && child.material.color.r === 0 && 
                child.material.color.g === 0 && child.material.color.b === 0) {
              child.material.color.set(0xcccccc);
            }
          }
        }
        
        child.userData = {
          type: 'building',
          name: generateBuildingName(child.name),
          id: child.name || `B${Math.floor(Math.random() * 1000)}`,
          position: child.position.clone(),
          selectable: true
        };
        
        allMeshes.push(child);
      }
    });
    
    if (!hasMeshes) {
      console.warn("Âª∫Á≠ëÁâ©Ê®°ÂûãÊ≤°ÊúâÂåÖÂê´‰ªª‰ΩïÁΩëÊ†º!");
    }
    
    buildingsGroup.add(buildings);
    console.log("Âª∫Á≠ëÁâ©Ê®°ÂûãÂ∑≤Ê∑ªÂä†Âà∞Âú∫ÊôØ");
    
  }, undefined, (error) => {
    console.error('Âä†ËΩΩÂª∫Á≠ëÁâ©Ê®°ÂûãÂ§±Ë¥•:', error);
    // ‰∏çÂÜç‰ΩøÁî®Â§áÁî®Âª∫Á≠ëÁâ©ÂàõÂª∫ÊñπÊ≥ï
  });
  
  // 3. Âä†ËΩΩÊëÑÂÉèÂ§¥Ê®°Âûã
  loader.load(`${cdnBase}/camera.gltf`, (gltf) => {
    console.log("ÊëÑÂÉèÂ§¥Ê®°ÂûãÂä†ËΩΩÊàêÂäü");
    
    const camerasModel = gltf.scene;
    
    // Â¶ÇÊûúÊëÑÂÉèÂ§¥Ê®°Âûã‰∏∫Á©∫ÊàñÊ≤°ÊúâÁΩëÊ†ºÔºåÂàõÂª∫Ëá™ÂÆö‰πâÊëÑÂÉèÂ§¥Ê†áËÆ∞
    let hasMeshes = false;
    camerasModel.traverse(child => {
      if (child.isMesh) {
        hasMeshes = true;
        child.castShadow = true;
        
        // ‰ΩøÊëÑÂÉèÂ§¥Êõ¥ÊòéÊòæ
        if (child.material) {
          if (Array.isArray(child.material)) {
            child.material.forEach(mat => {
              mat.emissive = new THREE.Color(0xff5722);
              mat.emissiveIntensity = 0.8;
              mat.needsUpdate = true;
            });
          } else {
            child.material.emissive = new THREE.Color(0xff5722);
            child.material.emissiveIntensity = 0.8;
            child.material.needsUpdate = true;
          }
        }
        
        // ‰øùÂ≠òÊëÑÂÉèÂ§¥ÁöÑÂÆûÈôÖ‰∏ñÁïåÂùêÊ†á
        const worldPosition = new THREE.Vector3();
        child.getWorldPosition(worldPosition);
        
        child.userData = {
          type: 'camera',
          name: generateCameraName(child.name), // ‰ΩøÁî®ÁîüÊàêÂáΩÊï∞Êõø‰ª£Áõ¥Êé•‰ΩøÁî®meshÂêçÁß∞
          id: child.name || `CAM-${Math.floor(Math.random() * 100)}`, // ‰øùÁïôÂéüÂßãmeshÂêçÁß∞‰Ωú‰∏∫ID
          // ‰ΩøÁî®ÂÆûÈôÖ‰∏ñÁïåÂùêÊ†áËÄå‰∏çÊòØÂ±ÄÈÉ®ÂùêÊ†á
          position: { 
            x: worldPosition.x, 
            y: worldPosition.y, 
            z: worldPosition.z 
          },
          status: Math.random() > 0.2, // 80%Ê¶ÇÁéáÂú®Á∫ø
          visibilityControl: true, // ÊòØÂê¶ÂèØÊéßÂà∂ËßÜÁ∫øÂèØËßÜÂåñ
          selectable: true
        };
        
        allMeshes.push(child);
      }
    });
    
    // Â¶ÇÊûúÊ®°ÂûãÊ≤°ÊúâÁΩëÊ†ºÔºåÂàôÂàõÂª∫Ëá™ÂÆö‰πâÊëÑÂÉèÂ§¥Ê†áËÆ∞
    if (!hasMeshes) {
      console.warn("ÊëÑÂÉèÂ§¥Ê®°ÂûãÊ≤°ÊúâÁΩëÊ†º");
      // ‰∏çÂÜçÂàõÂª∫Ëá™ÂÆö‰πâÊëÑÂÉèÂ§¥Ê†áËÆ∞
    } else {
      camerasGroup.add(camerasModel);
    }
    
    console.log("ÊëÑÂÉèÂ§¥Ê®°ÂûãÂ∑≤Ê∑ªÂä†Âà∞Âú∫ÊôØ");
    
  }, undefined, (error) => {
    console.error('Âä†ËΩΩÊëÑÂÉèÂ§¥Ê®°ÂûãÂ§±Ë¥•:', error);
  });
  
  // Ê∑ªÂä†Ë∞ÉËØïËæÖÂä©Â∑•ÂÖ∑
  // const axesHelper = new THREE.AxesHelper(50);
  // scene.add(axesHelper);
  
  const gridHelper = new THREE.GridHelper(200, 20);
  scene.add(gridHelper);
  
  // ÂàõÂª∫Êï∞ÊçÆÂèØËßÜÂåñÂ±Ç
  createDataVisualization();
  
  // Ë∞ÉÊï¥Áõ∏Êú∫ËßÜËßí‰ª•‰æø‰∫éÊü•ÁúãÊ®°Âûã
  setTimeout(() => {
    resetView();
  }, 1000);
}

/**
 * ÂàõÂª∫ÈÅìË∑Ø
 * ÁîüÊàêÊ∞¥Âπ≥ÂíåÂûÇÁõ¥ÁöÑÈÅìË∑ØÔºåÂΩ¢Êàê‰∫§ÂèâË∑ØÁΩë
 */
function createRoads() {
  // ÂàõÂª∫Ê∞¥Âπ≥ÈÅìË∑ØÂá†‰Ωï‰Ωì
  const horizontalRoadGeometry = new THREE.PlaneGeometry(180, 10);
  // ÂàõÂª∫ÈÅìË∑ØÊùêË¥® - Ê∑±ÁÅ∞Ëâ≤
  const roadMaterial = new THREE.MeshStandardMaterial({
    color: 0x424242, // Ê∑±ÁÅ∞Ëâ≤
    roughness: 0.9   // ËæÉÈ´òÁ≤óÁ≥ôÂ∫¶
  });
  
  // ÂàõÂª∫‰∏≠Â§ÆÊ∞¥Âπ≥ÈÅìË∑Ø
  const hRoad1 = new THREE.Mesh(horizontalRoadGeometry, roadMaterial);
  // ÊóãËΩ¨‰ΩøÂπ≥Èù¢Ê∞¥Âπ≥
  hRoad1.rotation.x = -Math.PI / 2;
  // Á®çÂæÆÊèêÈ´ò‰ΩçÁΩÆÔºåÈÅøÂÖç‰∏éÂú∞Èù¢ÈáçÂè†ÂØºËá¥ÁöÑz-fightingÔºàÈó™ÁÉÅÔºâ
  hRoad1.position.y = 0.1;
  // Ê∑ªÂä†Áî®Êà∑Êï∞ÊçÆ
  hRoad1.userData = {
    type: 'road',
    name: '‰∏ªÂπ≤ÈÅì',
    id: 'R1',
    position: { x: 0, y: 0.1, z: 0 },
    selectable: true
  };
  // Ê∑ªÂä†Âà∞ÈÅìË∑ØÁªÑ
  roadsGroup.add(hRoad1);
  // Ê∑ªÂä†Âà∞ÂèØ‰∫§‰∫íÁΩëÊ†ºÊï∞ÁªÑ
  allMeshes.push(hRoad1);
  
  // ÂàõÂª∫ÂûÇÁõ¥ÈÅìË∑ØÂá†‰Ωï‰Ωì
  const verticalRoadGeometry = new THREE.PlaneGeometry(10, 180);
  
  // ÂàõÂª∫‰∏≠Â§ÆÂûÇÁõ¥ÈÅìË∑Ø
  const vRoad1 = new THREE.Mesh(verticalRoadGeometry, roadMaterial);
  // ÊóãËΩ¨‰ΩøÂπ≥Èù¢Ê∞¥Âπ≥
  vRoad1.rotation.x = -Math.PI / 2;
  // Á®çÂæÆÊèêÈ´ò‰ΩçÁΩÆ
  vRoad1.position.y = 0.1;
  // Ê∑ªÂä†Áî®Êà∑Êï∞ÊçÆ
  vRoad1.userData = {
    type: 'road',
    name: 'ÊîØÂπ≤ÈÅì',
    id: 'R2',
    position: { x: 0, y: 0.1, z: 0 },
    selectable: true
  };
  // Ê∑ªÂä†Âà∞ÈÅìË∑ØÁªÑ
  roadsGroup.add(vRoad1);
  // Ê∑ªÂä†Âà∞ÂèØ‰∫§‰∫íÁΩëÊ†ºÊï∞ÁªÑ
  allMeshes.push(vRoad1);
}

/**
 * ÂàõÂª∫Êï∞ÊçÆÂèØËßÜÂåñ
 * ÂàùÂßãÂåñÊó∂‰∏çÊòæÁ§∫‰ªª‰ΩïÊï∞ÊçÆÔºåÁ≠âÂæÖÁî®Êà∑ÈÄâÊã©
 */
function createDataVisualization() {
  // ÂàùÂßãË∞ÉÁî®Êõ¥Êñ∞ÂáΩÊï∞Ôºå‰∏çÊòæÁ§∫‰ªª‰ΩïÊï∞ÊçÆ
  updateDataVisualization();
}

/**
 * Êõ¥Êñ∞Êï∞ÊçÆÂèØËßÜÂåñ
 * Ê†πÊçÆÁî®Êà∑ÈÄâÊã©ÁöÑÊï∞ÊçÆÁ±ªÂûã„ÄÅÊó∂Èó¥ÂíåÊó•ÊúüÁ±ªÂûãÊõ¥Êñ∞Êï∞ÊçÆÊü±Áä∂Âõæ
 */
function updateDataVisualization() {
  // Ê∏ÖÈô§Áé∞ÊúâÊï∞ÊçÆÂèØËßÜÂåñÂÜÖÂÆπ
  while(dataGroup.children.length > 0) {
    dataGroup.remove(dataGroup.children[0]);
  }
  
  // ‰ªéÂèØ‰∫§‰∫íÁΩëÊ†ºÊï∞ÁªÑ‰∏≠ÁßªÈô§ÊóßÁöÑÊï∞ÊçÆÂØπË±°
  allMeshes = allMeshes.filter(mesh => !mesh.userData || mesh.userData.type !== 'data');
  
  // Â¶ÇÊûúÊ≤°ÊúâÈÄâÊã©Êï∞ÊçÆÁ±ªÂûãÔºåÂàôÁõ¥Êé•ËøîÂõû
  if (selectedData.value === 'none') return;
  
  // ËÆæÁΩÆÁΩëÊ†ºÂ§ßÂ∞èÂíåÂçïÂÖÉÊ†ºÂ§ßÂ∞è
  const gridSize = 15; // 10x10ÁöÑÁΩëÊ†º
  const cellSize = 13; // ÊØè‰∏™ÂçïÂÖÉÊ†º10x10Âçï‰Ωç
  
  // ÈÅçÂéÜÁΩëÊ†ºÂàõÂª∫Êï∞ÊçÆÂèØËßÜÂåñ
  for (let i = 0; i < gridSize; i++) {
    for (let j = 0; j < gridSize; j++) {
      // ËÆ°ÁÆó‰ΩçÁΩÆÔºàÁõ∏ÂØπ‰∫éÁΩëÊ†º‰∏≠ÂøÉÔºâ
      const x = (i - gridSize/2) * cellSize + cellSize/2;
      const z = (j - gridSize/2) * cellSize + cellSize/2;
      
      // Ê†πÊçÆÊï∞ÊçÆÁ±ªÂûãËé∑ÂèñÈ´òÂ∫¶ÂÄºÂíåÈ¢úËâ≤
      let height = 0;
      let color;
      
      switch (selectedData.value) {
        case 'pedestrian': // Ë°å‰∫∫ÊµÅÈáè
          height = getPedestrianData(i, j) * 10; // ÊîæÂ§ß10ÂÄç‰æø‰∫éËßÇÂØü
          color = 0x4caf50; // ÁªøËâ≤
          break;
        case 'vehicle': // ËΩ¶ËæÜÊµÅÈáè
          height = getVehicleData(i, j) * 10;
          color = 0x2196f3; // ËìùËâ≤
          break;
        case 'combined': // ÁªºÂêàÊï∞ÊçÆ
          // ËΩ¶ËæÜÊï∞ÊçÆÊùÉÈáçÊõ¥È´òÔºà*1.5Ôºâ
          height = (getPedestrianData(i, j) + getVehicleData(i, j) * 1.5) * 5;
          color = 0xff9800; // Ê©ôËâ≤
          break;
      }
      
      // Â∑¶Ëæπ‰∏§ÊéíÁöÑÁΩëÊ†ºÂá†‰πéÊ≤°ÊúâÊï∞ÊçÆ
      if (i <= 1) {
        // Â∑¶Ëæπ‰∏§ÊéíÁöÑÁΩëÊ†ºÂè™ÊúâÊûÅÂ∞ëÈáèÊï∞ÊçÆÔºà1%ÁöÑÊ¶ÇÁéáÔºâ
        if (Math.random() > 0.99) {
          // ÊûÅÂ∞ëÈáèÁöÑÊï∞ÊçÆÔºåÈ´òÂ∫¶Âæà‰Ωé
          const height = 0.6;
          const color = selectedData.value === 'pedestrian' ? 0x4caf50 : 
                        (selectedData.value === 'vehicle' ? 0x2196f3 : 0xff9800);
          
          const geometry = new THREE.BoxGeometry(cellSize * 0.8, height, cellSize * 0.8);
          const material = new THREE.MeshStandardMaterial({
            color: color,
            transparent: true,
            opacity: 0.7,
            wireframe: isWireframe.value
          });
          
          const bar = new THREE.Mesh(geometry, material);
          bar.position.set(x, height / 2, z);
          bar.userData = {
            type: 'data',
            name: getDataName(selectedData.value, i, j),
            position: { x, y: height / 2, z },
            value: height / 10, // ÊòæÁ§∫ÂÆûÈôÖÂÄºÔºàÈô§‰ª•10Ôºâ
            selectable: true
          };
          
          // Ê∑ªÂä†Âà∞Êï∞ÊçÆÁªÑ
          dataGroup.add(bar);
          // Ê∑ªÂä†Âà∞ÂèØ‰∫§‰∫íÁΩëÊ†ºÊï∞ÁªÑ
          allMeshes.push(bar);
        }
      }
      // Âè™Âú®ÊúâÊòéÊòæÊï∞ÊçÆÁöÑÂú∞ÊñπÂàõÂª∫Êü±Áä∂Âõæ
      else if (height > 0.5) {
        // ‰∏∫ÊØè‰∏™ÁΩëÊ†ºÊ∑ªÂä†‰∏Ä‰∫õÈöèÊú∫ÂèòÂåñÔºå‰ΩøÊï∞ÊçÆÊõ¥Âä†Â∑ÆÂºÇÂåñ
        height = height * (0.85 + Math.random() * 0.3);
        
        // ÂàõÂª∫Êü±Áä∂ÂõæÂá†‰Ωï‰ΩìÂíåÊùêË¥®
        const geometry = new THREE.BoxGeometry(cellSize * 0.8, height, cellSize * 0.8);
        const material = new THREE.MeshStandardMaterial({
          color: color,
          transparent: true, // ÂºÄÂêØÈÄèÊòé
          opacity: 0.7,      // ÂçäÈÄèÊòéÊïàÊûú
          wireframe: isWireframe.value // ÊòØÂê¶ÊòæÁ§∫Á∫øÊ°ÜÊ®°Âºè
        });
        
        // ÂàõÂª∫ÁΩëÊ†º
        const bar = new THREE.Mesh(geometry, material);
        // ËÆæÁΩÆ‰ΩçÁΩÆÔºàÈ´òÂ∫¶ÁöÑ‰∏ÄÂçäÔºå‰ΩøÂ∫ïÈÉ®Âú®y=0Âπ≥Èù¢‰∏äÔºâ
        bar.position.set(x, height / 2, z);
        // Ê∑ªÂä†Áî®Êà∑Êï∞ÊçÆ
        bar.userData = {
          type: 'data',
          name: getDataName(selectedData.value, i, j),
          position: { x, y: height / 2, z },
          value: height / 10, // ÊòæÁ§∫ÂÆûÈôÖÂÄºÔºàÈô§‰ª•10Ôºâ
          selectable: true
        };
        
        // Ê∑ªÂä†Âà∞Êï∞ÊçÆÁªÑ
        dataGroup.add(bar);
        // Ê∑ªÂä†Âà∞ÂèØ‰∫§‰∫íÁΩëÊ†ºÊï∞ÁªÑ
        allMeshes.push(bar);
      }
    }
  }
}

/**
 * Ëé∑ÂèñÊï∞ÊçÆÊòæÁ§∫ÂêçÁß∞
 * @param {string} type - Êï∞ÊçÆÁ±ªÂûãÔºöpedestrian/vehicle/combined
 * @param {number} x - ÁΩëÊ†ºXÂùêÊ†á
 * @param {number} y - ÁΩëÊ†ºYÂùêÊ†á
 * @returns {string} Ê†ºÂºèÂåñÁöÑÊï∞ÊçÆÂêçÁß∞
 */
function getDataName(type, x, y) {
  const typeNames = {
    'pedestrian': t('model3d.dataTypes.pedestrian', 'Ë°å‰∫∫ÊµÅÈáè'),
    'vehicle': t('model3d.dataTypes.vehicle', 'ËΩ¶ËæÜÊµÅÈáè'),
    'combined': t('model3d.dataTypes.combined', 'ÁªºÂêàÊï∞ÊçÆ')
  };
  return `${typeNames[type]} (${x},${y})`;
}

/**
 * Ëé∑ÂèñÊ®°ÊãüË°å‰∫∫Êï∞ÊçÆ
 * Ê†πÊçÆ‰ΩçÁΩÆ„ÄÅÊó∂Èó¥ÂíåÊó•ÊúüÁ±ªÂûãÁîüÊàêÊ®°ÊãüÊï∞ÊçÆ
 * @param {number} x - ÁΩëÊ†ºXÂùêÊ†á
 * @param {number} y - ÁΩëÊ†ºYÂùêÊ†á
 * @returns {number} ÁîüÊàêÁöÑÊï∞ÊçÆÂÄºÔºà0-1ËåÉÂõ¥Ôºâ
 */
function getPedestrianData(x, y) {
  // Ê†πÊçÆÊó∂Èó¥ÂíåÊó•ÊúüÁ±ªÂûãËé∑ÂèñË∞ÉÊï¥Âõ†Â≠ê
  const hourFactor = getHourFactor(currentHour.value);
  const dayFactor = dayType.value === 'workday' ? 1 : 0.7; // ‰ºëÊÅØÊó•‰∫∫ÊµÅÂáèÂ∞ë30%
  
  // ÂàõÂª∫‰∏çÂêåÂå∫ÂüüÁöÑÁÉ≠ÁÇπ
  let value = 0;
  
  // Âè≥‰æßÂå∫ÂüüÔºàÂá†‰πéÊó†‰∫∫ÊµÅÔºâ
  if (x > 10) {
    value = Math.random() * 0.05; // ÊûÅ‰Ωé‰∫∫ÊµÅ
  }
  // Âè≥‰∏äÂå∫ÂüüÔºàÂá†‰πéÊó†‰∫∫ÊµÅÔºâ
  else if (x > 8 && y > 8) {
    value = Math.random() * 0.05; // ÊûÅ‰Ωé‰∫∫ÊµÅ
  }
  // Âè≥‰∏ãÂå∫ÂüüÔºàÂá†‰πéÊó†‰∫∫ÊµÅÔºâ
  else if (x > 8 && y < 2) {
    value = Math.random() * 0.05; // ÊûÅ‰Ωé‰∫∫ÊµÅ
  }
  // ‰∏≠ÂøÉÂå∫ÂüüÔºàÈ´ò‰∫∫ÊµÅÔºâ
  else if (Math.abs(x - 5) < 2 && Math.abs(y - 5) < 2) {
    value = 0.8;
  }
  // ÈÅìË∑Ø‰∫§ÂèâÂè£Ôºà‰∏≠Á≠â‰∫∫ÊµÅÔºâ
  else if ((Math.abs(x - 5) < 1 || Math.abs(y - 5) < 1) && 
      !(Math.abs(x - 5) < 1 && Math.abs(y - 5) < 1)) {
    // ÂûÇÁõ¥ÈÅìË∑Ø‰∏äÁöÑ‰∫∫ÊµÅÈáèÈöèÊú∫ÂàÜÂ∏ÉÔºå‰∏çÊòØÊâÄÊúâ‰ΩçÁΩÆÈÉΩÊúâ‰∫∫
    if (Math.abs(x - 5) < 1 && Math.random() > 0.4) {
      value = 0.6;
    }
    // Ê∞¥Âπ≥ÈÅìË∑Ø‰∏äÁöÑ‰∫∫ÊµÅÈáè
    else if (Math.abs(y - 5) < 1) {
      value = 0.6;
    }
  }
  // Âª∫Á≠ëÁâ©Âë®Âõ¥ÔºàËæÉ‰Ωé‰∫∫ÊµÅÔºâ
  else if ((x < 3 && y < 3) || (x > 7 && y > 7 && x <= 8)) {
    value = 0.4;
  }
  // ÂÖ∂‰ªñÂå∫ÂüüÔºàÈöèÊú∫‰ΩéÂÄºÔºâ
  else {
    value = Math.random() * 0.3;
  }
  
  // Â∫îÁî®Êó∂Èó¥ÂíåÊó•ÊúüÂõ†Â≠ê
  return value * hourFactor * dayFactor;
}

/**
 * Ëé∑ÂèñÊ®°ÊãüËΩ¶ËæÜÊï∞ÊçÆ
 * Ê†πÊçÆ‰ΩçÁΩÆ„ÄÅÊó∂Èó¥ÂíåÊó•ÊúüÁ±ªÂûãÁîüÊàêÊ®°ÊãüÊï∞ÊçÆ
 * @param {number} x - ÁΩëÊ†ºXÂùêÊ†á
 * @param {number} y - ÁΩëÊ†ºYÂùêÊ†á
 * @returns {number} ÁîüÊàêÁöÑÊï∞ÊçÆÂÄºÔºà0-1ËåÉÂõ¥Ôºâ
 */
function getVehicleData(x, y) {
  // Ê†πÊçÆÊó∂Èó¥ÂíåÊó•ÊúüÁ±ªÂûãËé∑ÂèñË∞ÉÊï¥Âõ†Â≠ê
  const hourFactor = getHourFactor(currentHour.value);
  const dayFactor = dayType.value === 'workday' ? 1 : 0.5; // ‰ºëÊÅØÊó•ËΩ¶ÊµÅÂáèÂ∞ë50%
  
  // ‰∏ªË¶ÅÂú®ÈÅìË∑Ø‰∏äÂàÜÂ∏ÉËΩ¶ËæÜ
  let value = 0;
  
  // Âè≥‰æßÂå∫ÂüüÔºàÂá†‰πéÊó†ËΩ¶ÊµÅÔºâ
  if (x > 10) {
    value = Math.random() * 0.02; // ÊûÅ‰ΩéËΩ¶ÊµÅ
  }
  // Âè≥‰∏äÂíåÂè≥‰∏ãÂå∫ÂüüÔºàÂá†‰πéÊó†ËΩ¶ÊµÅÔºâ
  else if ((x > 8 && y > 8) || (x > 8 && y < 2)) {
    value = Math.random() * 0.02; // ÊûÅ‰ΩéËΩ¶ÊµÅ
  }
  // Ê∞¥Âπ≥ÈÅìË∑ØÔºà‰∏çÂùáÂåÄÂàÜÂ∏ÉÔºâ
  else if (Math.abs(y - 5) < 1 && Math.random() > 0.2) {
    value = 0.7;
  }
  // ÂûÇÁõ¥ÈÅìË∑ØÔºà‰∏çÂùáÂåÄÂàÜÂ∏ÉÔºå‰∏îÊØîÊ∞¥Âπ≥ÈÅìË∑ØÂ∞ëÔºâ
  else if (Math.abs(x - 5) < 1 && Math.random() > 0.4) {
    value = 0.5;
  }
  // ‰∫§ÂèâÂè£ÔºàÈ´òËΩ¶ÊµÅÔºâ
  else if (Math.abs(x - 5) < 1 && Math.abs(y - 5) < 1) {
    value = 1;
  }
  // ÂÖ∂‰ªñÂå∫ÂüüÂæàÂ∞ëÊúâËΩ¶
  else {
    value = Math.random() * 0.05;
  }
  
  // Â∫îÁî®Êó∂Èó¥ÂíåÊó•ÊúüÂõ†Â≠ê
  return value * hourFactor * dayFactor;
}

/**
 * Ê†πÊçÆÂ∞èÊó∂Ëé∑ÂèñÊ¥ªÂä®Âõ†Â≠ê
 * ‰∏çÂêåÊó∂ÊÆµ‰∫∫ÊµÅËΩ¶ÊµÅÈáèÁöÑÂèòÂåñÁ≥ªÊï∞
 * @param {number} hour - Â∞èÊó∂(0-23)
 * @returns {number} Ê¥ªÂä®Âõ†Â≠ê(0-1ËåÉÂõ¥)
 */
function getHourFactor(hour) {
  // Êó©È´òÂ≥∞ 7-9ÁÇπÔºåÈÄíÂ¢û
  if (hour >= 7 && hour <= 9) {
    return 0.8 + (hour - 7) * 0.1;
  }
  // ‰∏≠Âçà 11-13ÁÇπÔºåÈÄÇ‰∏≠
  else if (hour >= 11 && hour <= 13) {
    return 0.7;
  }
  // ÊôöÈ´òÂ≥∞ 17-19ÁÇπÔºåÈÄíÂáè
  else if (hour >= 17 && hour <= 19) {
    return 0.9 + (19 - hour) * 0.1;
  }
  // Êôö‰∏äÂíåÂáåÊô® 20-5ÁÇπÔºå‰ΩéÂÄº
  else if (hour >= 20 || hour <= 5) {
    return 0.3;
  }
  // ÂÖ∂‰ªñÊó∂ÊÆµÔºå‰∏≠Á≠âÂÄº
  else {
    return 0.5;
  }
}

/**
 * Êõ¥Êñ∞Âü∫‰∫éÊó∂Èó¥ÁöÑÊï∞ÊçÆ
 * ÂΩìÊó∂Èó¥ÊªëÂùóÂèòÂåñÊó∂Ë∞ÉÁî®Ê≠§ÂáΩÊï∞
 */
function updateTimeBasedData() {
  // Âè™ÊúâÂΩìÈÄâÊã©‰∫ÜÊï∞ÊçÆÁ±ªÂûãÊó∂ÊâçÊõ¥Êñ∞
  if (selectedData.value !== 'none') {
    updateDataVisualization();
  }
}

/**
 * ÂàáÊç¢Êó•ÊúüÁ±ªÂûã
 * @param {string} type - Êó•ÊúüÁ±ªÂûãÔºöworkday/weekend
 */
function setDayType(type) {
  dayType.value = type;
  // Êõ¥Êñ∞Êï∞ÊçÆÂèØËßÜÂåñ
  updateTimeBasedData();
}

/**
 * Ê†ºÂºèÂåñÂ∞èÊó∂ÊòæÁ§∫
 * @param {number} hour - Â∞èÊó∂(0-23)
 * @returns {string} Ê†ºÂºèÂåñÁöÑÊó∂Èó¥Â≠óÁ¨¶‰∏≤ÔºåÂ¶Ç"12:00"
 */
function formatHour(hour) {
  return `${hour}:00`;
}

/**
 * Ê†ºÂºèÂåñ‰ΩçÁΩÆ‰ø°ÊÅØ
 * Â∞ÜÂùêÊ†áËΩ¨Êç¢‰∏∫‰ΩçÁΩÆÊèèËø∞Ôºå‰ΩøÁî®mesh IDÂíåÂª∫Á≠ëÁâ©IDËøõË°åÊò†Â∞Ñ
 * @param {Object} position - ‰∏âÁª¥ÂùêÊ†á
 * @param {string} id - ÂØπË±°IDÔºåÂèØËÉΩÊòØmesh IDÊàñÂª∫Á≠ëÁâ©ID
 * @returns {string} ‰ΩçÁΩÆÊèèËø∞
 */
function formatPosition(position, id, type) {
  // ‰ªéID‰∏≠ÊèêÂèñmeshÁºñÂè∑
  let meshNumber = '';
  if (id) {
    const match = id.match(/mesh_(\d+)/);
    if (match) {
      meshNumber = 'mesh_' + match[1];
    }
  }
  
  // Ê†πÊçÆÂØπË±°Á±ªÂûãÈÄâÊã©‰∏çÂêåÁöÑÊò†Â∞ÑË°®
  if (type === 'camera' && meshNumber) {
    // Â∞ùËØï‰ΩøÁî®i18nËé∑ÂèñÊëÑÂÉèÂ§¥‰ΩçÁΩÆÊèèËø∞
    const translatedLocation = t(`model3d.locations.cameras.${meshNumber}`, null);
    if (translatedLocation) {
      return translatedLocation;
    }
  } else if (type === 'building' && meshNumber) {
    // Â∞ùËØï‰ΩøÁî®i18nËé∑ÂèñÂª∫Á≠ëÁâ©‰ΩçÁΩÆÊèèËø∞
    const translatedLocation = t(`model3d.locations.buildings.${meshNumber}`, null);
    if (translatedLocation) {
      return translatedLocation;
    }
  }
  
  // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞Êò†Â∞ÑÔºåËøîÂõûÂùêÊ†áÊ†ºÂºè
  if (position) {
    return `X: ${position.x.toFixed(1)}, Y: ${position.y.toFixed(1)}, Z: ${position.z.toFixed(1)}`;
  }
  
  return t('model3d.objectInfo.unknownLocation');
}

/**
 * ÂàáÊç¢ÂõæÂ±ÇÊòæÁ§∫
 * Ê†πÊçÆÂ§çÈÄâÊ°ÜÁä∂ÊÄÅÊòæÁ§∫ÊàñÈöêËóèÁâπÂÆöÂõæÂ±Ç
 * @param {string} layerName - ÂõæÂ±ÇÂêçÁß∞Ôºöbuildings/roads/cameras/data
 */
function toggleLayer(layerName) {
  switch (layerName) {
    case 'buildings':
      buildingsGroup.visible = layers.value.buildings;
      break;
    case 'roads':
      roadsGroup.visible = layers.value.roads;
      break;
    case 'cameras':
      camerasGroup.visible = layers.value.cameras;
      break;
    case 'visionLines':
      // Â¶ÇÊûúÂõæÂ±ÇË¢´ÂêØÁî®‰ΩÜÊ®°ÂûãËøòÊú™Âä†ËΩΩÔºåÁõ¥Êé•Âä†ËΩΩÊ®°Âûã
      if (layers.value.visionLines && !modelLoadStatus.value.visionLines) {
        try {
          loadVisionLinesModel();
        } catch (error) {
          console.error('Âä†ËΩΩËßÜÁ∫øÁ∫øÊÆµÊ®°ÂûãÂ§±Ë¥•:', error);
          // Âä†ËΩΩÂ§±Ë¥•Êó∂ÔºåËá™Âä®ÂÖ≥Èó≠ËØ•ÂõæÂ±Ç
          layers.value.visionLines = false;
          visionLinesGroup.visible = false;
        }
      } else {
        visionLinesGroup.visible = layers.value.visionLines;
      }
      break;
    case 'visionPlane':
      // Â¶ÇÊûúÂõæÂ±ÇË¢´ÂêØÁî®‰ΩÜÊ®°ÂûãËøòÊú™Âä†ËΩΩÔºåÁõ¥Êé•Âä†ËΩΩÊ®°Âûã
      if (layers.value.visionPlane && !modelLoadStatus.value.visionPlane) {
        try {
          loadVisionPlaneModel();
        } catch (error) {
          console.error('Âä†ËΩΩËßÜÈáéÂπ≥Èù¢Ê®°ÂûãÂ§±Ë¥•:', error);
          // Âä†ËΩΩÂ§±Ë¥•Êó∂ÔºåËá™Âä®ÂÖ≥Èó≠ËØ•ÂõæÂ±Ç
          layers.value.visionPlane = false;
          visionPlaneGroup.visible = false;
        }
      } else {
        visionPlaneGroup.visible = layers.value.visionPlane;
      }
      break;
    case 'data':
      dataGroup.visible = layers.value.data;
      break;
  }
}

/**
 * ÂàáÊç¢Á∫øÊ°ÜÊ®°Âºè
 * ÂàáÊç¢ÊâÄÊúâÁΩëÊ†ºÁöÑÁ∫øÊ°ÜÊòæÁ§∫Ê®°Âºè
 */
function toggleWireframe() {
  // ÂèçËΩ¨Á∫øÊ°ÜÊ®°ÂºèÁä∂ÊÄÅ
  isWireframe.value = !isWireframe.value;
  
  // Êõ¥Êñ∞ÊâÄÊúâÂèØËßÅÁâ©‰ΩìÁöÑÁ∫øÊ°ÜÊ®°Âºè
  allMeshes.forEach(mesh => {
    if (mesh.material) {
      mesh.material.wireframe = isWireframe.value;
    }
  });
  
  // ÈáçÊñ∞ÂàõÂª∫Êï∞ÊçÆÂèØËßÜÂåñÔºåÂ∫îÁî®Á∫øÊ°ÜÊïàÊûú
  if (selectedData.value !== 'none') {
    updateDataVisualization();
  }
}

/**
 * ÈáçÁΩÆËßÜËßí
 * ‰ΩøÁî®TWEENÂπ≥ÊªëËøáÊ∏°Âà∞ÈªòËÆ§ËßÜËßí
 */
function resetView() {
  // ‰ΩøÁî®TWEENÂàõÂª∫Áõ∏Êú∫‰ΩçÁΩÆÁöÑÂπ≥ÊªëËøáÊ∏°Âä®Áîª
  new TWEEN.Tween(camera.position)
    .to({ x: 50, y: 50, z: 50 }, 1000) // ÁõÆÊ†á‰ΩçÁΩÆÂíåÊåÅÁª≠Êó∂Èó¥(ÊØ´Áßí)
    .easing(TWEEN.Easing.Cubic.Out) // ÁºìÂä®ÂáΩÊï∞
    .start();
    
  // ÂàõÂª∫ÊéßÂà∂ÁõÆÊ†áÁÇπÁöÑÂπ≥ÊªëËøáÊ∏°Âä®Áîª
  new TWEEN.Tween(controls.target)
    .to({ x: 0, y: 0, z: 0 }, 1000)
    .easing(TWEEN.Easing.Cubic.Out)
    .start();
}

/**
 * Â§ÑÁêÜÊ®°ÂûãÁÇπÂáª‰∫ã‰ª∂
 * Ê£ÄÊµãÁÇπÂáª‰ΩçÁΩÆÊòØÂê¶ÊúâÂèØÈÄâ‰∏≠ÁöÑÁâ©‰Ωì
 * @param {Event} event - Èº†Ê†áÁÇπÂáª‰∫ã‰ª∂
 */
function onCanvasClick(event) {
  // ËÆ°ÁÆóÈº†Ê†áÂú®Ê†áÂáÜÂåñËÆæÂ§áÂùêÊ†á‰∏≠ÁöÑ‰ΩçÁΩÆÔºà-1Âà∞1‰πãÈó¥Ôºâ
  const rect = modelCanvas.value.getBoundingClientRect();
  mouse.x = ((event.clientX - rect.left) / modelCanvas.value.clientWidth) * 2 - 1;
  mouse.y = -((event.clientY - rect.top) / modelCanvas.value.clientHeight) * 2 + 1;
  
  // ‰ªéÁõ∏Êú∫‰ΩçÁΩÆÊ≤øÈº†Ê†áÁÇπÂáªÊñπÂêëÂèëÂ∞ÑÂ∞ÑÁ∫ø
  raycaster.setFromCamera(mouse, camera);
  
  // ËÆ°ÁÆóÂ∞ÑÁ∫ø‰∏éÂèØÈÄâ‰∏≠Áâ©‰ΩìÁöÑ‰∫§ÁÇπ
  const intersects = raycaster.intersectObjects(allMeshes);
  
  // Â¶ÇÊûúÊúâ‰∫§ÁÇπÔºåÈÄâ‰∏≠Á¨¨‰∏Ä‰∏™Áâ©‰Ωì
  if (intersects.length > 0) {
    const object = intersects[0].object;
    // Âè™ÈÄâÊã©Ê†áËÆ∞‰∏∫ÂèØÈÄâ‰∏≠ÁöÑÁâ©‰Ωì
    if (object.userData && object.userData.selectable) {
      selectedObject.value = object.userData;
    }
  } else {
    // Êó†‰∫§ÁÇπÊó∂Ê∏ÖÈô§ÈÄâ‰∏≠Áä∂ÊÄÅ
    selectedObject.value = null;
  }
}

/**
 * ÊòæÁ§∫ÊëÑÂÉèÂ§¥Êï∞ÊçÆ
 * ÊâìÂºÄÊëÑÂÉèÂ§¥Êï∞ÊçÆÊ®°ÊÄÅÊ°ÜÂπ∂ÂàùÂßãÂåñÂõæË°®
 */
function showCameraData() {
  // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
  showCameraModal.value = true;
  
  // Á°Æ‰øùÂú®DOMÊõ¥Êñ∞ÂêéÂàùÂßãÂåñÂõæË°®
  setTimeout(() => {
    if (activeTab.value === 'data') {
      initCameraChart();
    }
  }, 50);
}

/**
 * ÂàùÂßãÂåñÊëÑÂÉèÂ§¥Êï∞ÊçÆÂõæË°®
 * ‰ΩøÁî®EChartsÂàõÂª∫24Â∞èÊó∂Êï∞ÊçÆÂõæË°®
 */
function initCameraChart() {
  // Ëé∑ÂèñÂõæË°®ÂÆπÂô®
  const chartContainer = document.getElementById('cameraDataChart');
  if (!chartContainer) {
    console.error('Camera chart container not found');
    return;
  }
  
  // ÂàõÂª∫EChartsÂÆû‰æã
  const chartInstance = echarts.init(chartContainer);
  
  // ÁîüÊàê24Â∞èÊó∂Êï∞ÊçÆ
  const hours = Array.from({ length: 24 }, (_, i) => `${i}:00`);
  
  // ÁîüÊàêÈöèÊú∫Ë°å‰∫∫Êï∞ÊçÆÔºåÊ†πÊçÆ‰∏çÂêåÊó∂ÊÆµËÆæÁΩÆ‰∏çÂêåÂü∫Á°ÄÂÄº
  const pedestrianData = hours.map((_, i) => {
    if (i >= 7 && i <= 9) { // Êó©È´òÂ≥∞
      return Math.floor(Math.random() * 8) + 1;
    } else if (i >= 17 && i <= 19) { // ÊôöÈ´òÂ≥∞
      return Math.floor(Math.random() * 8) + 2;
    } else if (i >= 22 || i <= 5) { // Ê∑±Â§ú
      return Math.floor(Math.random() * 2);
    } else { // ÂÖ∂‰ªñÊó∂Èó¥
      return Math.floor(Math.random() * 5) + 0;
    }
  });
  
  // ÁîüÊàêÈöèÊú∫ËΩ¶ËæÜÊï∞ÊçÆ
  const vehicleData = hours.map((_, i) => {
    if (i >= 7 && i <= 9) { // Êó©È´òÂ≥∞
      return Math.floor(Math.random() * 9) + 1;
    } else if (i >= 17 && i <= 19) { // ÊôöÈ´òÂ≥∞
      return Math.floor(Math.random() * 10) + 2;
    } else if (i >= 22 || i <= 5) { // Ê∑±Â§ú
      return Math.floor(Math.random() * 6);
    } else { // ÂÖ∂‰ªñÊó∂Èó¥
      return Math.floor(Math.random() * 5) + 0;
    }
  });
  
  // ËÆæÁΩÆEChartsÈÖçÁΩÆÈÄâÈ°π
  const option = {
    title: {
      text: t('model3d.charts.cameraDetectionTitle', 'ÊëÑÂÉèÂ§¥Ê£ÄÊµãÊï∞ÊçÆÁªüËÆ°'),
      left: 'center'
    },
    tooltip: {
      trigger: 'axis'
    },
    legend: {
      data: [
        t('model3d.charts.pedestrianCount', 'Ë°å‰∫∫Êï∞Èáè'), 
        t('model3d.charts.vehicleCount', 'ËΩ¶ËæÜÊï∞Èáè')
      ],
      bottom: 10
    },
    grid: {
      left: '3%',
      right: '4%',
      bottom: '15%',
      containLabel: true
    },
    xAxis: {
      type: 'category',
      boundaryGap: false,
      data: hours,
      name: t('model3d.charts.timeAxis', 'Êó∂Èó¥')
    },
    yAxis: {
      type: 'value',
      name: t('model3d.charts.countAxis', 'Êï∞Èáè')
    },
    series: [
      // Ë°å‰∫∫Êï∞ÈáèÁ∫ø
      {
        name: t('model3d.charts.pedestrianCount', 'Ë°å‰∫∫Êï∞Èáè'),
        type: 'line',
        data: pedestrianData,
        smooth: true,
        lineStyle: {
          width: 2,
          color: '#42b983'
        },
        areaStyle: {
          color: {
            type: 'linear',
            x: 0,
            y: 0,
            x2: 0,
            y2: 1,
            colorStops: [
              { offset: 0, color: 'rgba(66, 185, 131, 0.5)' },
              { offset: 1, color: 'rgba(66, 185, 131, 0.1)' }
            ]
          }
        }
      },
      // ËΩ¶ËæÜÊï∞ÈáèÁ∫ø
      {
        name: t('model3d.charts.vehicleCount', 'ËΩ¶ËæÜÊï∞Èáè'),
        type: 'line',
        data: vehicleData,
        smooth: true,
        lineStyle: {
          width: 2,
          color: '#3080e8'
        },
        areaStyle: {
          color: {
            type: 'linear',
            x: 0,
            y: 0,
            x2: 0,
            y2: 1,
            colorStops: [
              { offset: 0, color: 'rgba(48, 128, 232, 0.5)' },
              { offset: 1, color: 'rgba(48, 128, 232, 0.1)' }
            ]
          }
        }
      }
    ]
  };
  
  // Â∫îÁî®ÈÖçÁΩÆÔºåÁîüÊàêÂõæË°®
  chartInstance.setOption(option);
}

/**
 * Êõ¥Êñ∞Ê£ÄÊµãÂàóË°®DOM
 * @param {Array} detections - Ê£ÄÊµãËÆ∞ÂΩïÊï∞ÁªÑ
 */
function updateDetectionList(detections) {
  const detectionList = document.getElementById('detectionList');
  if (!detectionList) return;
  
  // Ê∏ÖÁ©∫Áé∞ÊúâÂÜÖÂÆπ
  detectionList.innerHTML = '';
  
  // Ê∑ªÂä†ÊØè‰∏™Ê£ÄÊµãËÆ∞ÂΩï
  detections.forEach(detection => {
    const item = document.createElement('div');
    item.className = 'detection-item';
    item.innerHTML = `
      <div class="detection-time">${detection.time}</div>
      <div class="detection-type detection-type-${detection.type}">${detection.type === 'pedestrian' ? t('model3d.detection.pedestrian', 'Ë°å‰∫∫') : t('model3d.detection.vehicle', 'ËΩ¶ËæÜ')}</div>
      <div class="detection-description">${detection.description}</div>
    `;
    detectionList.appendChild(item);
  });
}

/**
 * Ë∞ÉÊï¥Á™óÂè£Â§ßÂ∞è‰∫ã‰ª∂Â§ÑÁêÜÂáΩÊï∞
 * Âú®Á™óÂè£Â§ßÂ∞èÂèòÂåñÊó∂ÈáçÊñ∞Ë∞ÉÊï¥Ê∏≤ÊüìÂô®ÂíåÁõ∏Êú∫
 */
function onWindowResize() {
  console.log("Á™óÂè£Â§ßÂ∞èÊîπÂèò");
  // Ê£ÄÊü•ÂøÖË¶ÅÁªÑ‰ª∂ÊòØÂê¶Â∑≤ÂàùÂßãÂåñ
  if (!camera || !renderer || !modelCanvas.value) {
    console.error("Êó†Ê≥ïË∞ÉÊï¥Â§ßÂ∞èÔºöÁªÑ‰ª∂Êú™ÂÆåÂÖ®ÂàùÂßãÂåñ");
    return;
  }
  
  // Ëé∑ÂèñÊñ∞ÁöÑÁ™óÂè£Â∞∫ÂØ∏
  const width = window.innerWidth;
  const height = window.innerHeight;
  
  // Êõ¥Êñ∞Áõ∏Êú∫ÂÆΩÈ´òÊØî
  camera.aspect = width / height;
  // Êõ¥Êñ∞Áõ∏Êú∫ÊäïÂΩ±Áü©Èòµ
  camera.updateProjectionMatrix();
  
  // Ë∞ÉÊï¥Ê∏≤ÊüìÂô®Â∞∫ÂØ∏
  renderer.setSize(width, height);
  console.log("Ê∏≤ÊüìÂô®Â∞∫ÂØ∏Â∑≤Êõ¥Êñ∞:", width, height);
}

/**
 * Âä®ÁîªÂæ™ÁéØÂáΩÊï∞
 * ÊåÅÁª≠Ê∏≤ÊüìÂú∫ÊôØÔºåÂÆûÁé∞3D‰∫§‰∫íÊïàÊûú
 */
let frameCount = 0;
function animate() {
  // ËØ∑Ê±Ç‰∏ã‰∏ÄÂ∏ßÂä®Áîª
  requestAnimationFrame(animate);
  
  // ËÆ°Êï∞Â∏ßÊï∞ÔºåÁî®‰∫éË∞ÉËØï
  frameCount++;
  if (frameCount % 60 === 0) { // ÊØè60Â∏ßËÆ∞ÂΩï‰∏ÄÊ¨°
    //console.log("Âä®ÁîªÂ∏ß:", frameCount);
  }
  
  // Êõ¥Êñ∞ËΩ®ÈÅìÊéßÂà∂Âô®ÔºàÂÆûÁé∞ÈòªÂ∞ºÊïàÊûúÔºâ
  if (orbitControlsEnabled.value) {
    controls.update();
  }
  
  // Êõ¥Êñ∞Ë°•Èó¥Âä®ÁîªÔºàÂÆûÁé∞Âπ≥ÊªëËøáÊ∏°ÊïàÊûúÔºâ
  TWEEN.update();
  
  // Ê∏≤ÊüìÂú∫ÊôØ
  renderer.render(scene, camera);
}

// === ÁîüÂëΩÂë®ÊúüÈí©Â≠ê ===

/**
 * ÁªÑ‰ª∂ÊåÇËΩΩÊó∂ÂàùÂßãÂåñThree.jsÂíåECharts
 * Âú®VueÁªÑ‰ª∂Ë¢´ÊåÇËΩΩÂà∞DOMÂêéÊâßË°å
 */
onMounted(() => {
  console.log("ÁªÑ‰ª∂Â∑≤ÊåÇËΩΩ");
  
  // Á°Æ‰øùDOMÂ∑≤ÂÆåÂÖ®Âä†ËΩΩÂÜçÂàùÂßãÂåñ
  setTimeout(() => {
    // ÂàùÂßãÂåñThree.jsÂú∫ÊôØ
    initThreeJS();
    // ÂàùÂßãÂåñÂÆûÊó∂ÂõæË°®
    initRealtimeChart();
    
    // ËÆæÁΩÆ‰∏Ä‰∏™È¢ùÂ§ñÁöÑÊ£ÄÊü•Ôºå‰ª•Á°Æ‰øù3DÂú∫ÊôØÊ≠£Á°ÆÊ∏≤Êüì
    setTimeout(() => {
      if (renderer && modelCanvas.value) {
        console.log("ÊâßË°åÂº∫Âà∂ÈáçÊñ∞Ë∞ÉÊï¥Â§ßÂ∞è");
        onWindowResize();
      }
    }, 500);
  }, 100);
  
  // ÁõëÂê¨ÊëÑÂÉèÂ§¥Ê®°ÊÄÅÊ°ÜÁöÑÊ†áÁ≠æÂàáÊç¢
  // ÂΩìactiveTabÊîπÂèòÊó∂Ëß¶ÂèëÂõûË∞ÉÂáΩÊï∞
  watch(activeTab, (newTab) => {
    if (newTab === 'data' && showCameraModal.value) {
      // Á°Æ‰øùDOMÊõ¥Êñ∞ÂêéÂàùÂßãÂåñÂõæË°®
      setTimeout(() => {
        initCameraChart();
      }, 50);
    }
  });
});

/**
 * ÁªÑ‰ª∂Âç∏ËΩΩÂâçÊ∏ÖÁêÜËµÑÊ∫ê
 * Èò≤Ê≠¢ÂÜÖÂ≠òÊ≥ÑÊºèÂíåËµÑÊ∫êÂç†Áî®
 */
onBeforeUnmount(() => {
  // ÁßªÈô§‰∫ã‰ª∂ÁõëÂê¨Âô®
  window.removeEventListener('resize', onWindowResize);
  
  // ÁßªÈô§ÁÇπÂáª‰∫ã‰ª∂ÁõëÂê¨Âô®
  if (renderer && renderer.domElement) {
    renderer.domElement.removeEventListener('click', onCanvasClick);
  }
  
  // ÈáäÊîæThree.jsËµÑÊ∫ê
  if (renderer) {
    renderer.dispose(); // ÈáäÊîæWebGL‰∏ä‰∏ãÊñá
    // ‰ªéDOM‰∏≠ÁßªÈô§canvasÂÖÉÁ¥†
    if (modelCanvas.value) {
      modelCanvas.value.removeChild(renderer.domElement);
    }
  }
  
  // ÈáäÊîæEChartsÂÆû‰æã
  if (realtimeChartInstance) {
    realtimeChartInstance.dispose();
  }
  
  // ÈáäÊîæÂá†‰Ωï‰ΩìÂíåÊùêË¥®ÔºåÈò≤Ê≠¢ÂÜÖÂ≠òÊ≥ÑÊºè
  allMeshes.forEach(mesh => {
    // ÈáäÊîæÂá†‰Ωï‰Ωì
    if (mesh.geometry) mesh.geometry.dispose();
    // ÈáäÊîæÊùêË¥®ÔºàÂèØËÉΩÊòØÊï∞ÁªÑÊàñÂçï‰∏™ÊùêË¥®Ôºâ
    if (mesh.material) {
      if (Array.isArray(mesh.material)) {
        mesh.material.forEach(m => m.dispose());
      } else {
        mesh.material.dispose();
      }
    }
  });
});

/**
 * ÂàáÊç¢ÁâπÂÆöÊëÑÂÉèÂ§¥ÁöÑËßÜÁ∫øÂèØËßÜÂåñ
 * @param {string} cameraId - ÊëÑÂÉèÂ§¥ID
 * @param {string} visionType - ËßÜÁ∫øÁ±ªÂûãÔºö'lines'/'points'
 */
function toggleCameraVision(cameraId, visionType) {
  // ËøôÈáåÂ∫îËØ•ÂÆûÁé∞ÂàáÊç¢ÁâπÂÆöÊëÑÂÉèÂ§¥ËßÜÁ∫øÊòæÁ§∫ÁöÑÈÄªËæë
  // Áî±‰∫éËøôÈúÄË¶Å‰øÆÊîπÊï∞ÊçÆÁªìÊûÑÂíåÈ¢ùÂ§ñÁöÑ‰ª£Á†ÅÔºåÊ≠§Â§Ñ‰ªÖ‰∏∫Âç†‰Ωç
  console.log(`ÂàáÊç¢ÊëÑÂÉèÂ§¥ ${cameraId} ÁöÑ ${visionType} ÊòæÁ§∫Áä∂ÊÄÅ`);
}

/**
 * Ê£ÄÊü•ÁâπÂÆöÊëÑÂÉèÂ§¥ÁöÑËßÜÁ∫øÊòØÂê¶ÂèØËßÅ
 * @param {string} cameraId - ÊëÑÂÉèÂ§¥ID
 * @param {string} visionType - ËßÜÁ∫øÁ±ªÂûãÔºö'lines'/'points'
 * @returns {boolean} ÊòØÂê¶ÂèØËßÅ
 */
function isCameraVisionVisible(cameraId, visionType) {
  // ËøôÈáåÂ∫îËØ•ËøîÂõûÁâπÂÆöÊëÑÂÉèÂ§¥ËßÜÁ∫øÁöÑÂèØËßÅÁä∂ÊÄÅ
  // Áî±‰∫éËøôÈúÄË¶Å‰øÆÊîπÊï∞ÊçÆÁªìÊûÑÂíåÈ¢ùÂ§ñÁöÑ‰ª£Á†ÅÔºåÊ≠§Â§Ñ‰ªÖËøîÂõûÂÖ®Â±ÄÂõæÂ±ÇÁä∂ÊÄÅ
  return visionType === 'lines' ? layers.value.visionLines : layers.value.visionPoints;
}

// Ê∑ªÂä†Êñ∞ÂèòÈáèÁî®‰∫éË∑üË∏™Ê®°ÂûãÂä†ËΩΩÁä∂ÊÄÅ
const modelLoadStatus = ref({
  visionLines: false, // ÊòØÂê¶Â∑≤Âä†ËΩΩËßÜÁ∫øÁ∫øÊÆµÊ®°Âûã
  visionPoints: false, // ÊòØÂê¶Â∑≤Âä†ËΩΩËßÜÁ∫øÊäïÂΩ±ÁÇπÊ®°Âûã
  visionPlane: false, // ÊòØÂê¶Â∑≤Âä†ËΩΩËßÜÈáéÂπ≥Èù¢Ê®°Âûã
});

/**
 * ÊåâÈúÄÂä†ËΩΩÊëÑÂÉèÂ§¥ËßÜÁ∫øÊäïÂΩ±ÁÇπÊ®°Âûã
 * Ê≠§ÂäüËÉΩÂ∑≤Ë¢´Á¶ÅÁî®
 */
function loadVisionPointsModel() {
  console.log("ËßÜÁ∫øÊäïÂΩ±ÁÇπÂäüËÉΩÂ∑≤Ë¢´Á¶ÅÁî®");
  // ‰∏çÂÜçÂä†ËΩΩËßÜÁ∫øÊäïÂΩ±ÁÇπÊ®°Âûã
  // Ê†áËÆ∞‰∏∫Â∑≤Âä†ËΩΩÔºàÂÆûÈôÖ‰∏äÂπ∂Êú™Âä†ËΩΩÔºâÔºåÈÅøÂÖçÈáçÂ§çË∞ÉÁî®
  modelLoadStatus.value.visionPoints = true;
  // Á°Æ‰øùËßÜÁ∫øÊäïÂΩ±ÁÇπÁªÑÂßãÁªà‰∏çÂèØËßÅ
  visionPointsGroup.visible = false;
}

/**
 * ÊåâÈúÄÂä†ËΩΩÊëÑÂÉèÂ§¥ËßÜÁ∫øÁ∫øÊÆµÊ®°Âûã
 * Âè™Âú®Áî®Êà∑ÈúÄË¶ÅÊó∂ÊâçÂä†ËΩΩÊ≠§Ê®°Âûã
 */
function loadVisionLinesModel() {
  const cdnEnBase = 'https://smart-community-cdn.b-cdn.net';
  console.log("‰ΩøÁî®CDNÂõΩÈôÖË∑ØÂæÑ:", cdnEnBase);
  console.log("ÂºÄÂßãÂä†ËΩΩÊëÑÂÉèÂ§¥ËßÜÁ∫øÁ∫øÊÆµÊ®°Âûã");
  
  // ÊòæÁ§∫Âä†ËΩΩËøõÂ∫¶Êù°ÔºåËÆæÁΩÆÊ®°ÂûãÂêçÁß∞
  modelLoading.isLoading = true;
  modelLoading.model = t('model3d.panels.layerControl.visionLines', 'ÊëÑÂÉèÂ§¥ËßÜÁ∫øÁ∫øÊÆµ');
  modelLoading.progress = 0;
  
  // ÂàõÂª∫GLTFÂä†ËΩΩÂô®
  const loader = new GLTFLoader();
  
  // Âä†ËΩΩÊëÑÂÉèÂ§¥ËßÜÁ∫øÁ∫øÊÆµ
  // ‰øÆÊ≠£Ë∑ØÂæÑÔºåÁ°Æ‰øùÊ≠£Á°ÆÂä†ËΩΩ
  const modelPath = `${cdnEnBase}/vision_lines.gltf`;
  console.log("Â∞ùËØïÂä†ËΩΩÊ®°ÂûãÔºö", modelPath);
  
  loader.load(modelPath,(gltf) => {
      // ÈöêËóèÂä†ËΩΩËøõÂ∫¶Êù°
      modelLoading.isLoading = false;
      
      // Ê£ÄÊü•gltfÂíåsceneÊòØÂê¶Â≠òÂú®
      if (!gltf || !gltf.scene) {
        console.error('Âä†ËΩΩÁöÑÊ®°ÂûãÁº∫Â∞ësceneÂ±ûÊÄß');
        modelLoadStatus.value.visionLines = true; 
        visionLinesGroup.visible = false;
        return;
      }
      
      const sceneRoot = gltf.scene;
      try {
        sceneRoot.traverse((child) => {
          // Ê†πÊçÆÁ±ªÂûãËá™Âä®Ê∑ªÂä†Âà∞Âú∫ÊôØ
          if (child.isMesh || child.isPoints || child.isLineSegments) {
            // ËÆæÁΩÆËßÜÁ∫øÁ∫øÊÆµÁöÑÊùêË¥®ÔºàÈ¢úËâ≤Ê¢ØÂ∫¶Ôºâ
            if (child.isMesh) {
              child.material = new THREE.MeshBasicMaterial({
                color: 0xff3300,
                transparent: true,
                opacity: 0.05,
                side: THREE.DoubleSide,
              });
            }

            child.userData = {
              type: 'vision_line',
              name: 'ÊëÑÂÉèÂ§¥ËßÜÁ∫ø',
              selectable: false
            };
            
            visionLinesGroup.add(child);
            allMeshes.push(child);
          }
        });
        console.log('Âä†ËΩΩÂÆåÊàêvision_lines', gltf);
        // Êõ¥Êñ∞Âä†ËΩΩÁä∂ÊÄÅ
        modelLoadStatus.value.visionLines = true;
      } catch (error) {
        console.error('Â§ÑÁêÜvision_linesÊ®°ÂûãÊó∂Âá∫Èîô:', error);
        modelLoadStatus.value.visionLines = true;
        visionLinesGroup.visible = false;
      }
    },
    (xhr) => {
      // Êõ¥Êñ∞Âä†ËΩΩËøõÂ∫¶ÁôæÂàÜÊØî
      if (xhr.lengthComputable) {
        const percentComplete = (xhr.loaded / xhr.total) * 100;
        modelLoading.progress = percentComplete;
        console.log(`Âä†ËΩΩËøõÂ∫¶: ${percentComplete.toFixed(1)}%,vision_lines`);
      }
    },
    (err) => {
      // ÈöêËóèÂä†ËΩΩËøõÂ∫¶Êù°
      modelLoading.isLoading = false;
      
      console.error('Âä†ËΩΩÈîôËØØ:vision_lines', err);
      modelLoadStatus.value.visionLines = true;
      visionLinesGroup.visible = false;
      layers.value.visionLines = false;
    }
  );
}

/**
 * ÊåâÈúÄÂä†ËΩΩÊëÑÂÉèÂ§¥ËßÜÈáéÂπ≥Èù¢Ê®°Âûã
 * Âè™Âú®Áî®Êà∑ÈúÄË¶ÅÊó∂ÊâçÂä†ËΩΩÊ≠§Ê®°Âûã
 */
function loadVisionPlaneModel() {
  console.log("ÂºÄÂßãÂä†ËΩΩÊëÑÂÉèÂ§¥ËßÜÈáéÂπ≥Èù¢Ê®°Âûã");
  const cdnBase = 'https://fidmrvwmxwnqcvtyzyjk.supabase.co/storage/v1/object/public/smart-community-pics-models/';

  // ÊòæÁ§∫Âä†ËΩΩËøõÂ∫¶Êù°ÔºåËÆæÁΩÆÊ®°ÂûãÂêçÁß∞
  modelLoading.isLoading = true;
  modelLoading.model = t('model3d.panels.layerControl.visionPlane', 'ÊëÑÂÉèÂ§¥ËßÜÈáéÂπ≥Èù¢');
  modelLoading.progress = 0;
  
  // ÂàõÂª∫GLTFÂä†ËΩΩÂô®
  const loader = new GLTFLoader();
  
  // Âä†ËΩΩÊëÑÂÉèÂ§¥ËßÜÈáéÂπ≥Èù¢
  // ‰øÆÊ≠£Ë∑ØÂæÑÔºåÁ°Æ‰øùÊ≠£Á°ÆÂä†ËΩΩ
  const modelPath = `${cdnBase}/vision_plane.gltf`;
  
  console.log("Â∞ùËØïÂä†ËΩΩÊ®°ÂûãÔºö", modelPath);
  
  loader.load(modelPath,(gltf) => {
      // ÈöêËóèÂä†ËΩΩËøõÂ∫¶Êù°
      modelLoading.isLoading = false;
      
      // Ê£ÄÊü•gltfÂíåsceneÊòØÂê¶Â≠òÂú®
      if (!gltf || !gltf.scene) {
        console.error('Âä†ËΩΩÁöÑËßÜÈáéÂπ≥Èù¢Ê®°ÂûãÁº∫Â∞ësceneÂ±ûÊÄß');
        modelLoadStatus.value.visionPlane = true; 
        visionPlaneGroup.visible = false;
        return;
      }
      
      const sceneRoot = gltf.scene;
      try {
        sceneRoot.traverse((child) => {
          // Ê†πÊçÆÁ±ªÂûãËá™Âä®Ê∑ªÂä†Âà∞Âú∫ÊôØ
          if (child.isMesh) {
            // ËÆæÁΩÆËßÜÈáéÂπ≥Èù¢ÁöÑÊùêË¥®ÔºàÂçäÈÄèÊòéÈªÑËâ≤Ôºâ
            child.material = new THREE.MeshBasicMaterial({ 
              color: 0xffcc00, 
              transparent: true, 
              opacity: 0.3,
              side: THREE.DoubleSide
            });
            
            child.userData = {
              type: 'vision_plane',
              name: 'ÊëÑÂÉèÂ§¥ËßÜÈáéÂπ≥Èù¢',
              selectable: false
            };
            
            visionPlaneGroup.add(child);
            allMeshes.push(child);
          }
        });
        console.log('Âä†ËΩΩÂÆåÊàêvision_plane', gltf);
        // Êõ¥Êñ∞Âä†ËΩΩÁä∂ÊÄÅ
        modelLoadStatus.value.visionPlane = true;
      } catch (error) {
        console.error('Â§ÑÁêÜvision_planeÊ®°ÂûãÊó∂Âá∫Èîô:', error);
        modelLoadStatus.value.visionPlane = true;
        visionPlaneGroup.visible = false;
      }
    },
    (xhr) => {
      // Êõ¥Êñ∞Âä†ËΩΩËøõÂ∫¶ÁôæÂàÜÊØî
      if (xhr.lengthComputable) {
        const percentComplete = (xhr.loaded / xhr.total) * 100;
        modelLoading.progress = percentComplete;
        console.log(`Âä†ËΩΩËøõÂ∫¶: ${percentComplete.toFixed(1)}%,vision_plane`);
      }
    },
    (err) => {
      // ÈöêËóèÂä†ËΩΩËøõÂ∫¶Êù°
      modelLoading.isLoading = false;
      
      console.error('Âä†ËΩΩÈîôËØØ:vision_plane', err);
      modelLoadStatus.value.visionPlane = true;
      visionPlaneGroup.visible = false;
      layers.value.visionPlane = false;
    }
  );
}


/**
 * Ê†πÊçÆÊëÑÂÉèÂ§¥IDËé∑ÂèñÂØπÂ∫îÁöÑÂõæÂÉèURL
 * @param {string} cameraId - ÊëÑÂÉèÂ§¥IDÔºàmeshÂêçÔºâ
 * @returns {string} ÂõæÂÉèURL
 */
function getCameraImageUrl(cameraId) {
  // ‰ªéID‰∏≠ÊèêÂèñmeshÁºñÂè∑
  const match = cameraId && cameraId.match(/mesh_(\d+)/);
  const cameraNum = match ? match[1].padStart(2, '0') : '00';
  console.log('cameraNum', cameraNum);
  
  // ‰ΩøÁî®ÁºñÂè∑ÊûÑÂª∫ÂõæÂÉèURLË∑ØÂæÑ
  const imageUrl = `../src/assets/Camera_images/mesh_${cameraNum}.jpeg`;
  console.log('imageUrl', imageUrl);
  
  // Â¶ÇÊûúÊ≤°ÊúâÊúâÊïàIDÔºåËøîÂõûÈªòËÆ§Âç†‰ΩçÂõæ
  if (!cameraId) {
    return 'https://via.placeholder.com/800x450.png?text=ÊëÑÂÉèÂ§¥ÂÆûÊó∂ÂõæÂÉè';
  }
  
  return imageUrl;
}

/**
 * Ê†πÊçÆÊëÑÂÉèÂ§¥IDËé∑ÂèñÂØπÂ∫îÁöÑmaskÂõæÂÉèURL
 * @param {string} cameraId - ÊëÑÂÉèÂ§¥IDÔºàmeshÂêçÔºâ
 * @returns {string} ÂõæÂÉèURL
 */
 function getCameraMaskImageUrl(cameraId) {
  // ‰ªéID‰∏≠ÊèêÂèñmeshÁºñÂè∑
  const match = cameraId && cameraId.match(/mesh_(\d+)/);
  const cameraNum = match ? match[1].padStart(2, '0') : '00';
  console.log('cameraNum', cameraNum);
  
  // ‰ΩøÁî®ÁºñÂè∑ÊûÑÂª∫ÂõæÂÉèURLË∑ØÂæÑ
  const imageUrl = `../src/assets/Camera_masks/${cameraNum}.jpg`;
  console.log('imageUrl', imageUrl);
  
  // Â¶ÇÊûúÊ≤°ÊúâÊúâÊïàIDÔºåËøîÂõûÈªòËÆ§Âç†‰ΩçÂõæ
  if (!cameraId) {
    return 'https://via.placeholder.com/800x450.png?text=ÊëÑÂÉèÂ§¥ÂÆûÊó∂ÂõæÂÉè';
  }
  
  return imageUrl;
}

/**
 * Ê†πÊçÆÊëÑÂÉèÂ§¥IDËé∑ÂèñÂØπÂ∫îÁöÑmask‰∏éÁúüÂÆûÊëÑÂÉèÂ§¥ÁîªÈù¢ÁöÑÂõæÂÉèURL
 * @param {string} cameraId - ÊëÑÂÉèÂ§¥IDÔºàmeshÂêçÔºâ
 * @returns {string} ÂõæÂÉèURL
 */
 function getCameraMaskAndRealImageUrl(cameraId) {
  // ‰ªéID‰∏≠ÊèêÂèñmeshÁºñÂè∑
  const match = cameraId && cameraId.match(/mesh_(\d+)/);
  const cameraNum = match ? match[1].padStart(2, '0') : '00';
  console.log('cameraNum', cameraNum);
  
  // ‰ΩøÁî®ÁºñÂè∑ÊûÑÂª∫ÂõæÂÉèURLË∑ØÂæÑ
  const imageUrl = `../src/assets/Camera_masks/mask_${cameraNum}.jpeg`;
  console.log('imageUrl', imageUrl);
  
  // Â¶ÇÊûúÊ≤°ÊúâÊúâÊïàIDÔºåËøîÂõûÈªòËÆ§Âç†‰ΩçÂõæ
  if (!cameraId) {
    return 'https://via.placeholder.com/800x450.png?text=ÊëÑÂÉèÂ§¥ÂÆûÊó∂ÂõæÂÉè';
  }
  
  return imageUrl;
}

/**
 * Ê†πÊçÆÊëÑÂÉèÂ§¥IDËé∑ÂèñÂØπÂ∫îÁöÑÂõæÂÉèURL
 * @param {string} cameraId - ÊëÑÂÉèÂ§¥IDÔºàmeshÂêçÔºâ
 * @returns {string} ÂõæÂÉèURL
 */
 function getCameraYolov5ImageUrl(cameraId) {
  // ‰ªéID‰∏≠ÊèêÂèñmeshÁºñÂè∑
  const match = cameraId && cameraId.match(/mesh_(\d+)/);
  const cameraNum = match ? match[1].padStart(2, '0') : '00';
  console.log('cameraNum', cameraNum);
  
  // ‰ΩøÁî®ÁºñÂè∑ÊûÑÂª∫ÂõæÂÉèURLË∑ØÂæÑ
  const imageUrl = `../src/assets/Camera_yolov5/mesh_${cameraNum}.jpg`;
  console.log('imageUrl', imageUrl);
  
  // Â¶ÇÊûúÊ≤°ÊúâÊúâÊïàIDÔºåËøîÂõûÈªòËÆ§Âç†‰ΩçÂõæ
  if (!cameraId) {
    return 'https://via.placeholder.com/800x450.png?text=ÊëÑÂÉèÂ§¥ÂÆûÊó∂ÂõæÂÉè';
  }
  
  return imageUrl;
}

// ‰∏∫‰∏çÂêåÊëÑÂÉèÂ§¥IDÈ¢ÑÂÆö‰πâÊ£ÄÊµãÊï∞ÊçÆ
const cameraDetectionData = {
  'mesh_0': { pedestrians: 2, vehicles: 7, illegalPedestrians: 1, illegalVehicles: 1 },
  'mesh_1': { pedestrians: 2, vehicles: 3, illegalPedestrians: 1, illegalVehicles: 1 },
  'mesh_2': { pedestrians: 3, vehicles: 0, illegalPedestrians: 1, illegalVehicles: 0 },
  'mesh_3': { pedestrians: 1, vehicles: 6, illegalPedestrians: 0, illegalVehicles: 1 },
  'mesh_4': { pedestrians: 1, vehicles: 4, illegalPedestrians: 0, illegalVehicles: 1 },
  'mesh_5': { pedestrians: 10, vehicles: 0, illegalPedestrians: 1, illegalVehicles: 0 },
  'mesh_6': { pedestrians: 4, vehicles: 4, illegalPedestrians: 1, illegalVehicles: 0 },
  'mesh_7': { pedestrians: 5, vehicles: 4, illegalPedestrians: 2, illegalVehicles: 2 }, 
  'mesh_8': { pedestrians: 4, vehicles: 0, illegalPedestrians: 1, illegalVehicles: 0 },
  'mesh_9': { pedestrians: 3, vehicles: 3, illegalPedestrians: 1, illegalVehicles: 1 },
  'mesh_10': { pedestrians: 1, vehicles: 0, illegalPedestrians: 0, illegalVehicles: 0 },
  'mesh_11': { pedestrians: 2, vehicles: 0, illegalPedestrians: 1, illegalVehicles: 1 },
  'mesh_12': { pedestrians: 2, vehicles: 0, illegalPedestrians: 0, illegalVehicles: 0 },
  'mesh_13': { pedestrians: 3, vehicles: 3, illegalPedestrians: 1, illegalVehicles: 0 },
  'mesh_14': { pedestrians: 2, vehicles: 0, illegalPedestrians: 1, illegalVehicles: 0 },
  'mesh_15': { pedestrians: 3, vehicles: 0, illegalPedestrians: 0, illegalVehicles: 0 },
  'mesh_16': { pedestrians: 1, vehicles: 4, illegalPedestrians: 0, illegalVehicles: 0 },
  'mesh_17': { pedestrians: 2, vehicles: 6, illegalPedestrians: 1, illegalVehicles: 0 },
  'mesh_18': { pedestrians: 2, vehicles: 2, illegalPedestrians: 0, illegalVehicles: 0 },
  'mesh_19': { pedestrians: 2, vehicles: 0, illegalPedestrians: 0, illegalVehicles: 0 },
  'mesh_20': { pedestrians: 1, vehicles: 0, illegalPedestrians: 0, illegalVehicles: 0 },
  'mesh_21': { pedestrians: 2, vehicles: 3, illegalPedestrians: 1, illegalVehicles: 0 },
  'mesh_22': { pedestrians: 2, vehicles: 0, illegalPedestrians: 1, illegalVehicles: 0 },
  'mesh_23': { pedestrians: 1, vehicles: 5, illegalPedestrians: 0, illegalVehicles: 0 },
  'mesh_24': { pedestrians: 2, vehicles: 2, illegalPedestrians: 1, illegalVehicles: 2 },
  'mesh_25': { pedestrians: 1, vehicles: 3, illegalPedestrians: 0, illegalVehicles: 0 },
  'mesh_26': { pedestrians: 1, vehicles: 3, illegalPedestrians: 0, illegalVehicles: 0 },
  'mesh_27': { pedestrians: 3, vehicles: 8, illegalPedestrians: 0, illegalVehicles: 4 },
  'mesh_28': { pedestrians: 2, vehicles: 2, illegalPedestrians: 1, illegalVehicles: 0 },
  'mesh_29': { pedestrians: 1, vehicles: 0, illegalPedestrians: 1, illegalVehicles: 0 },
  'mesh_30': { pedestrians: 2, vehicles: 0, illegalPedestrians: 1, illegalVehicles: 0 },
  'mesh_31': { pedestrians: 2, vehicles: 5, illegalPedestrians: 1, illegalVehicles: 0 },
  'mesh_32': { pedestrians: 2, vehicles: 1, illegalPedestrians: 1, illegalVehicles: 0 },
  'mesh_33': { pedestrians: 2, vehicles: 6, illegalPedestrians: 1, illegalVehicles: 2 },
  'mesh_34': { pedestrians: 11, vehicles: 4, illegalPedestrians: 5, illegalVehicles: 1 },
  'mesh_35': { pedestrians: 3, vehicles: 1, illegalPedestrians: 1, illegalVehicles: 0 },
  'mesh_36': { pedestrians: 3, vehicles: 5, illegalPedestrians: 1, illegalVehicles: 0 },
  // ÂèØ‰ª•ÁªßÁª≠Ê∑ªÂä†Êõ¥Â§öÊëÑÂÉèÂ§¥ÁöÑÊï∞ÊçÆ
};

/**
 * Ê†πÊçÆÊëÑÂÉèÂ§¥IDËé∑ÂèñÊ£ÄÊµãÊï∞ÊçÆ
 */
function getCameraDetectionData(cameraId) {
  // Â∞ùËØïÂåπÈÖçÂÆåÊï¥ID
  if (cameraDetectionData[cameraId]) {
    return cameraDetectionData[cameraId];
  }
  
  // Â∞ùËØïÂåπÈÖçID‰∏≠ÁöÑmeshÁºñÂè∑
  const match = cameraId && cameraId.match(/mesh_(\d+)/);
  if (match && cameraDetectionData[`mesh_${match[1]}`]) {
    return cameraDetectionData[`mesh_${match[1]}`];
  }
  
  // Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÊï∞ÊçÆÔºåËøîÂõûÈªòËÆ§ÂÄº
  return { pedestrians: 0, vehicles: 0, illegalPedestrians: 0, illegalVehicles: 0 };
}

// Ê∑ªÂä†ÂÖ®Â±èÊü•ÁúãÊ®°ÊÄÅÊ°Ü
const showSitePlanModal = ref(false);

// Ê∑ªÂä†Âπ≥Èù¢ÂõæÁ±ªÂûãÁä∂ÊÄÅ
const siteplanType = ref('normal'); // 'normal'Ë°®Á§∫Âπ≥Èù¢ÂõæÔºå'satellite'Ë°®Á§∫Âç´ÊòüÂõæ

// Ê∑ªÂä†ÂàáÊç¢Âπ≥Èù¢ÂõæÂÖ®Â±èÊòæÁ§∫ÁöÑÊñπÊ≥ï
function toggleSitePlanFullscreen() {
  showSitePlanModal.value = !showSitePlanModal.value;
}

// Ê∑ªÂä†ÂàáÊç¢Âπ≥Èù¢ÂõæÁ±ªÂûãÁöÑÊñπÊ≥ï
function changeSiteplanType(type) {
  siteplanType.value = type;
}

// Ê∑ªÂä†Ê®°ÂûãÂä†ËΩΩÁä∂ÊÄÅ
const modelLoading = reactive({
  isLoading: false,
  model: '',
  progress: 0
});

</script>

<style>
/* ÈùûscopedÊ†∑ÂºèÔºåÁ°Æ‰øùËÉΩË¶ÜÁõñÂÖ®Â±ÄÊ†∑Âºè */
/* ‰ΩøÁî®!importantÊ†áËÆ∞Á°Æ‰øùÊ†∑Âºè‰ºòÂÖàÁ∫ßÈ´ò‰∫éÂÖ®Â±ÄÊ†∑Âºè */

/* 3DÊ®°ÂûãÂÆπÂô®Ê†∑Âºè - Á°Æ‰øùÂÖ®Â±èÊòæÁ§∫ */
.model-3d {
  position: fixed !important; /* Âõ∫ÂÆöÂÆö‰Ωç */
  top: 0 !important;
  left: 0 !important;
  width: 100vw !important; /* 100%ËßÜÂè£ÂÆΩÂ∫¶ */
  height: 100vh !important; /* 100%ËßÜÂè£È´òÂ∫¶ */
  overflow: hidden !important; /* ÈöêËóèÊ∫¢Âá∫ÂÜÖÂÆπ */
  z-index: 1 !important; /* Á°Æ‰øùÂú®ÂÖ∂‰ªñÂÜÖÂÆπ‰πã‰∏ä */
  margin: 0 !important;
  padding: 0 !important;
}

/* ‰∏ªÂÆπÂô®Ê†∑Âºè */
.main-container {
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  z-index: 1 !important;
}

/* 3DÁîªÂ∏ÉÂÆπÂô®Ê†∑Âºè */
.model-canvas-container {
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  z-index: 1 !important; /* z-index‰∏∫1ÔºåÁ°Æ‰øùÂú®ËÉåÊôØÂ±Ç‰πã‰∏ä */
  margin: 0 !important;
  padding: 0 !important;
}

/* 3DÁîªÂ∏ÉÊ†∑Âºè */
.model-canvas {
  width: 100% !important;
  height: 100% !important;
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  background-color: #222 !important; /* Ê∑±ÁÅ∞Ëâ≤ËÉåÊôØ */
  margin: 0 !important;
  padding: 0 !important;
}

/* Three.jsÁîüÊàêÁöÑcanvasÂÖÉÁ¥†Ê†∑Âºè */
.model-canvas canvas {
  display: block !important; /* Èò≤Ê≠¢canvasÂ∫ïÈÉ®Âá∫Áé∞Èó¥Èöô */
  width: 100% !important;
  height: 100% !important;
}

/* Ê†áÈ¢òÊ†∑Âºè */
h1 {
  position: fixed !important;
  top: 80px !important;
  left: 0 !important;
  right: 0 !important;
  text-align: center !important;
  margin: 0 !important;
  color: #fff !important;
  font-size: 1.8rem !important;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important; /* ÊñáÂ≠óÈò¥ÂΩ±ÊïàÊûú */
  z-index: 10 !important; /* Á°Æ‰øùÂú®3DÂú∫ÊôØ‰πã‰∏ä */
}

/* Â∑¶‰æßÊéßÂà∂Èù¢ÊùøÊ†∑Âºè */
.left-panel {
  position: fixed !important;
  top: calc(var(--navbar-height) + 15px) !important; /* Â¢ûÂä†È°∂ÈÉ®Èó¥Ë∑ù */
  left: 0.5rem !important;
  width: 220px !important; /* ÂáèÂ∞èÂÆΩÂ∫¶ */
  max-height: calc(100vh - var(--navbar-height) - var(--footer-height) - 20px) !important; /* ÂáèÂéªÈ°∂Ê†è„ÄÅÈ°µÂ∞æÂíåÈó¥Ë∑ù */
  overflow-y: auto !important;
  z-index: 100 !important; /* ‰Ωé‰∫éÈ°∂Ê†èÂíåÈ°µÂ∞æÁöÑz-index */
  display: flex !important;
  flex-direction: column !important;
  gap: 0.5rem !important; /* Èù¢Êùø‰πãÈó¥ÁöÑÈó¥Ë∑ùÁº©Â∞è */
  padding: 0 !important;
}

/* Âè≥‰æßÊï∞ÊçÆÈù¢ÊùøÊ†∑Âºè */
.right-panel {
  position: fixed !important;
  top: calc(var(--navbar-height) + 15px) !important; /* Â¢ûÂä†È°∂ÈÉ®Èó¥Ë∑ù */
  right: 0.5rem !important;
  width: 250px !important; /* ÂáèÂ∞èÂÆΩÂ∫¶ */
  max-height: calc(100vh - var(--navbar-height) - var(--footer-height) - 20px) !important; /* ÂáèÂéªÈ°∂Ê†è„ÄÅÈ°µÂ∞æÂíåÈó¥Ë∑ù */
  overflow-y: auto !important;
  z-index: 100 !important;
  display: flex !important;
  flex-direction: column !important;
  gap: 0.5rem !important; /* Èù¢Êùø‰πãÈó¥ÁöÑÈó¥Ë∑ùÁº©Â∞è */
  padding: 0 !important;
}

/* Èù¢ÊùøÈÄöÁî®Ê†∑Âºè - ÂçäÈÄèÊòéÊïàÊûú */
.panel-section {
  background: rgba(255, 255, 255, 0.85) !important; /* ÂçäÈÄèÊòéÁôΩËâ≤ËÉåÊôØ */
  backdrop-filter: blur(5px) !important; /* ËÉåÊôØÊ®°Á≥äÊïàÊûú */
  -webkit-backdrop-filter: blur(5px) !important; /* SafariÂÖºÂÆπ */
  border-radius: 8px !important; /* ÂúÜËßíËæπÊ°Ü */
  padding: 1rem !important;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15) !important; /* Èò¥ÂΩ±ÊïàÊûú */
  margin-bottom: 0.8rem !important;
  border: 1px solid rgba(0,0,0,0.05) !important; /* Ê∑ªÂä†ÁªÜËæπÊ°ÜÂ¢ûÂº∫ËßÜËßâÂå∫ÂàÜ */
  box-shadow: 0 2px 6px rgba(0,0,0,0.08) !important; /* Â¢ûÂº∫Èò¥ÂΩ±ÊïàÊûú */
}

/* Èù¢ÊùøÊ†áÈ¢òÊ†∑Âºè */
h3 {
  margin: 0 0 0.8rem 0;
  color: #2c3e50;
  font-size: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid #eaeaea; /* ‰∏ãËæπÊ°ÜÂàÜÈöîÁ∫ø */
}

/* ÂõæÂ±ÇÊéßÂà∂Âå∫ÂüüÊ†∑Âºè */
.layer-controls {
  display: flex;
  flex-direction: column;
  gap: 0.8rem; /* ÊéßÂà∂È°πÈó¥Ë∑ù */
}

/* ÂõæÂ±ÇÈ°πÊ†∑Âºè */
.layer-item {
  display: flex;
  align-items: center;
  gap: 0.5rem; /* Â§çÈÄâÊ°ÜÂíåÊñáÂ≠óÈó¥Ë∑ù */
}

/* Â§çÈÄâÊ°ÜÊ†∑Âºè */
input[type="checkbox"] {
  cursor: pointer; /* Èº†Ê†áÊÇ¨ÂÅúÊòæÁ§∫ÊâãÂûã */
}

/* ÊåâÈíÆÈÄöÁî®Ê†∑Âºè */
button {
  background: #42b983; /* ÁªøËâ≤ÊåâÈíÆ */
  color: white;
  border: none;
  padding: 0.6rem 1rem;
  border-radius: 4px;
  cursor: pointer;
  margin-right: 0.5rem;
  margin-bottom: 0.5rem;
  transition: background 0.3s; /* ËøáÊ∏°ÊïàÊûú */
}

/* ÊåâÈíÆÊÇ¨ÂÅúÊïàÊûú */
button:hover {
  background: #3aa876; /* Ê∑±ÁªøËâ≤ */
}

/* ÊøÄÊ¥ªÁä∂ÊÄÅÁöÑÊåâÈíÆ */
button.active {
  background: #333; /* Ê∑±ÁÅ∞Ëâ≤ */
}

/* ÊéßÂà∂ÊåâÈíÆÊ†∑Âºè */
.control-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  margin-right: 0;
}

/* ÊåâÈíÆÂõæÊ†áÊ†∑Âºè */
.icon {
  margin-right: 5px;
}

/* Êï∞ÊçÆÈÄâÊã©Âô®Ê†∑Âºè */
.data-select select {
  width: 100%;
  padding: 0.6rem;
  border-radius: 4px;
  border: 1px solid #ddd;
}

/* Êó∂Èó¥ÊªëÂä®Êù°ÂÆπÂô® */
.time-slider {
  margin-bottom: 1rem;
}

/* ÊªëÂä®Êù°Ê†∑Âºè */
input[type="range"] {
  width: 100%;
  margin-bottom: 0.5rem;
}

/* Êó∂Èó¥ÊòæÁ§∫Ê†∑Âºè */
.time-display {
  text-align: center;
  font-weight: bold;
  color: #2c3e50;
}

/* Êó•ÊúüÈÄâÊã©ÊåâÈíÆÂÆπÂô® */
.day-select {
  display: flex;
  justify-content: space-between;
}

/* ‰ø°ÊÅØÂÜÖÂÆπÂÆπÂô® */
.info-content {
  background-color: #f9f9f9;
  padding: 1rem;
  border-radius: 6px;
  min-height: 120px;
}

/* Êó†ÈÄâ‰∏≠ÂØπË±°Êó∂ÁöÑÊèêÁ§∫Ê†∑Âºè */
.info-placeholder {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #aaa;
  gap: 0.5rem;
}

/* ÊèêÁ§∫ÂõæÊ†áÊ†∑Âºè */
.placeholder-icon {
  font-size: 2rem;
}

/* ÂØπË±°‰ø°ÊÅØÂ§¥ÈÉ®Ê†∑Âºè */
.object-info-header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

/* ÂØπË±°Á±ªÂûãÂõæÊ†áÊ†∑Âºè */
.object-icon {
  font-size: 1.2rem;
}

/* ‰∏çÂêåÁ±ªÂûãÂØπË±°ÁöÑÂõæÊ†áÈ¢úËâ≤ */
.object-icon.building {
  color: #e74c3c; /* Á∫¢Ëâ≤ - Âª∫Á≠ëÁâ© */
}

.object-icon.road {
  color: #3498db; /* ËìùËâ≤ - ÈÅìË∑Ø */
}

.object-icon.camera {
  color: #f39c12; /* ÈªÑËâ≤ - ÊëÑÂÉèÂ§¥ */
}

.object-icon.data {
  color: #2ecc71; /* ÁªøËâ≤ - Êï∞ÊçÆËäÇÁÇπ */
}

/* ÂØπË±°‰ø°ÊÅØÊ†áÈ¢òÊ†∑Âºè */
.object-info-header h4 {
  margin: 0;
  font-size: 1.1rem;
  color: #2c3e50;
}

/* ÂØπË±°‰ø°ÊÅØÂÜÖÂÆπÊ†∑Âºè */
.object-info-body p {
  margin: 0.5rem 0;
  color: #5d6778;
}

/* Âú®Á∫øÁä∂ÊÄÅÊ†∑Âºè */
.status-online {
  color: #2ecc71; /* ÁªøËâ≤ */
  font-weight: bold;
}

/* Á¶ªÁ∫øÁä∂ÊÄÅÊ†∑Âºè */
.status-offline {
  color: #e74c3c; /* Á∫¢Ëâ≤ */
  font-weight: bold;
}

/* ÊëÑÂÉèÂ§¥Êï∞ÊçÆÊåâÈíÆÊ†∑Âºè */
.camera-data-btn {
  margin-top: 1rem;
  width: 100%;
}

/* ÁªüËÆ°Âç°ÁâáÂÆπÂô®Ê†∑Âºè */
.stats-cards {
  display: grid;
  grid-template-columns: repeat(2, 1fr); /* Êîπ‰∏∫‰∏§Âàó */
  gap: 0.8rem;
}

/* ÁªüËÆ°Âç°ÁâáÊ†∑Âºè */
.stat-card {
  background: linear-gradient(135deg, #f5f7fa 20%, #eaeaea 100%); /* Ê∏êÂèòËÉåÊôØ */
  padding: 0.8rem;
  border-radius: 6px;
  text-align: center;
  display: flex;
  flex-direction: column;
  min-height: 100px; /* Á°Æ‰øùÊâÄÊúâÂç°ÁâáÈ´òÂ∫¶‰∏ÄËá¥ */
}

/* ÁªüËÆ°Âç°ÁâáÊ†áÈ¢òÊ†∑Âºè */
.stat-title {
  font-size: 0.75rem; /* Áº©Â∞èÂ≠ó‰Ωì */
  color: #5d6778;
  margin-bottom: 0.3rem;
  word-break: break-word; /* Á°Æ‰øùÈïøÊñáÊú¨ËÉΩÊç¢Ë°å */
  line-height: 1.1; /* ÂáèÂ∞èË°åÈ´ò */
  overflow: hidden; /* Èò≤Ê≠¢Ê∫¢Âá∫ */
}

/* ÁªüËÆ°Âç°ÁâáÊï∞ÂÄºÊ†∑Âºè */
.stat-value {
  font-size: 1.2rem;
  font-weight: bold;
  color: #2c3e50;
  margin-bottom: 0.3rem;
  flex-grow: 1; /* ËÆ©Êï∞ÂÄºÂå∫ÂüüÂç†ÊçÆÊõ¥Â§öÁ©∫Èó¥ */
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ÁªüËÆ°Âç°ÁâáÊó∂Èó¥Ê†áÁ≠æÊ†∑Âºè */
.stat-time {
  font-size: 0.7rem;
  color: #7f8c8d;
  word-break: break-word; /* Á°Æ‰øùÈïøÊñáÊú¨ËÉΩÊç¢Ë°å */
}

/* ÂÆûÊó∂Êï∞ÊçÆÂõæË°®ÂÆπÂô®Ê†∑Âºè */
.realtime-data {
  display: flex;
  flex-direction: column;
}
/* Êï∞ÊçÆÂõæË°®ÂÆπÂô®Ê†∑Âºè */
.data-chart-container {
  width: 100%;
  height: 180px;
  margin-left: -1.5rem; /* Â¢ûÂä†Â∑¶‰æßËæπË∑ù‰ª•ÈÄÇÂ∫îyËΩ¥Ê†áÁ≠æ */
}

/* Êï∞ÊçÆÂõæË°®Ê†∑Âºè */
.data-chart {
  width: 100%;
  height: 100%;
}

/* ÂõæË°®Âõæ‰æãÂÆπÂô®Ê†∑Âºè */
.chart-legend {
  display: flex;
  justify-content: center;
  gap: 1rem;
}

/* Âõæ‰æãÈ°πÊ†∑Âºè */
.legend-item {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  font-size: 0.8rem;
}

/* Âõæ‰æãÈ¢úËâ≤ÊñπÂùóÊ†∑Âºè */
.legend-color {
  width: 10px;
  height: 10px;
  border-radius: 50%; /* ÂúÜÂΩ¢Âõæ‰æãÁÇπ */
}

/* ‰ΩøÁî®ËØ¥ÊòéÂàóË°®Ê†∑Âºè */
.instruction-list {
  list-style-type: none;
  padding-left: 0;
  margin: 0;
}

/* ‰ΩøÁî®ËØ¥ÊòéÈ°πÊ†∑Âºè */
.instruction-list li {
  padding: 0.5rem 0;
  border-bottom: 1px solid #f0f0f0;
  font-size: 0.9rem;
  color: #5d6778;
}

/* ÊúÄÂêé‰∏ÄÈ°π‰∏çÈúÄË¶Å‰∏ãËæπÊ°Ü */
.instruction-list li:last-child {
  border-bottom: none;
}

/* ÊëÑÂÉèÂ§¥Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
.camera-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6); /* ÂçäÈÄèÊòéÈªëËâ≤ËÉåÊôØ */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000; /* Á°Æ‰øùÂú®ÊúÄ‰∏äÂ±Ç */
}

/* Ê®°ÊÄÅÊ°ÜÂÜÖÂÆπÂÆπÂô® */
.modal-content {
  width: 80%;
  max-width: 900px;
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  overflow: hidden;
}

/* Ê®°ÊÄÅÊ°ÜÊ†áÈ¢òÊ†è */
.modal-header {
  padding: 1rem 1.5rem;
  background-color: #f3f3f3;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #ddd;
}

/* Ê®°ÊÄÅÊ°ÜÊ†áÈ¢ò */
.modal-header h3 {
  margin: 0;
  color: #2c3e50;
  border-bottom: none;
  padding-bottom: 0;
}

/* ÂÖ≥Èó≠ÊåâÈíÆÊ†∑Âºè */
.close-btn {
  background: none;
  border: none;
  font-size: 1.5rem;
  color: #5d6778;
  cursor: pointer;
  padding: 0;
  margin: 0;
}

/* Ê®°ÊÄÅÊ°ÜÂÜÖÂÆπÂå∫Âüü */
.modal-body {
  padding: 1.5rem;
}

/* Ê†áÁ≠æÈ°µÂØºËà™ */
.camera-tabs {
  display: flex;
  border-bottom: 1px solid #ddd;
  margin-bottom: 1.5rem;
}

/* Ê†áÁ≠æÈ°µÊåâÈíÆ */
.camera-tabs button {
  background: none;
  color: #5d6778;
  border: none;
  padding: 0.8rem 1.5rem;
  margin: 0;
  margin-bottom: -1px;
  border-bottom: 2px solid transparent; /* ÈÄèÊòéÂ∫ïÈÉ®ËæπÊ°Ü */
}

/* ÊøÄÊ¥ªÁä∂ÊÄÅÁöÑÊ†áÁ≠æÈ°µ */
.camera-tabs button.active {
  color: #42b983; /* ÁªøËâ≤ */
  border-bottom: 2px solid #42b983; /* ÁªøËâ≤Â∫ïÈÉ®ËæπÊ°Ü */
  background: none;
}

/* Ê†áÁ≠æÈ°µÂÜÖÂÆπÂå∫Âüü */
.tab-content {
  min-height: 300px;
}

/* ÂÆûÊó∂È¢ÑËßàÂÆπÂô® */
.live-preview {
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
}

/* È¢ÑËßàÂõæÂÉèÊ†∑Âºè */
.live-preview img {
  flex: 2;
  min-width: 300px;
  border-radius: 8px;
  max-width: 100%;
  height: auto;
}

/* Ê£ÄÊµã‰ø°ÊÅØÂå∫Âüü */
.detection-info {
  flex: 1;
  min-width: 200px;
  background-color: #f9f9f9;
  padding: 1.5rem;
  border-radius: 8px;
}

.stats-panel {
  margin-bottom: 20px;
}

.stats-panel h4 {
  font-size: 16px;
  margin-bottom: 10px;
  color: #333;
  border-bottom: 1px solid #e0e0e0;
  padding-bottom: 5px;
}

.stats-container {
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
}

.stat-box {
  flex: 0 0 30%;
  background-color: white;
  border-radius: 5px;
  padding: 12px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  text-align: center;
  transition: all 0.3s ease;
}

.stat-box:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.stat-title {
  font-size: 14px;
  color: #666;
  margin-bottom: 5px;
}

.stat-value {
  font-size: 18px;
  font-weight: bold;
  color: #42b983;
}

.time-value {
  font-size: 14px;
  color: #666;
}

#currentPedestrianCount {
  color: #42b983;
}

#currentVehicleCount {
  color: #2196f3;
}

/* ÊëÑÂÉèÂ§¥ÂõæË°®ÂÆπÂô® */
.camera-chart {
  height: 350px;
  width: 100%;
}

/* ÂìçÂ∫îÂºèËÆæËÆ°Ë∞ÉÊï¥ - Â§ßÂ±èÂπï */
@media (max-width: 1200px) {
  /* Âú®‰∏≠Á≠âÂ±èÂπï‰∏äÂáèÂ∞èÈù¢ÊùøÂÆΩÂ∫¶ */
  .left-panel, .right-panel {
    width: 250px;
  }
  
  /* ÂáèÂ∞èÈù¢ÊùøÂÜÖËæπË∑ù */
  .panel-section {
    padding: 0.8rem;
  }
}

/* ÂìçÂ∫îÂºèËÆæËÆ°Ë∞ÉÊï¥ - Â∞èÂ±èÂπï */
@media (max-width: 768px) {
  /* Âú®ÁßªÂä®ËÆæÂ§á‰∏äË∞ÉÊï¥Èù¢Êùø‰ΩçÁΩÆ */
  .left-panel, .right-panel {
    position: fixed;
    top: auto;
    bottom: 1rem;
    left: 1rem;
    right: 1rem;
    width: auto;
    max-height: 250px;
    flex-direction: column;
  }
  
  /* Âú®ÁßªÂä®ËÆæÂ§á‰∏äÈöêËóèÂè≥‰æßÈù¢Êùø */
  .right-panel {
    display: none;
  }
  
  /* Ë∞ÉÊï¥Èù¢ÊùøÂÆΩÂ∫¶ */
  .panel-section {
    width: auto;
  }
  
  /* Ê∑ªÂä†Èù¢ÊùøÂàáÊç¢ÊåâÈíÆÔºàÂú®ÁßªÂä®ËÆæÂ§á‰∏ä‰ΩøÁî®Ôºâ */
  .panel-toggle {
    position: fixed;
    top: 70px;
    right: 1rem;
    z-index: 20;
    display: block;
  }
}

/* 3DÊ®°ÂûãÈ°µÈù¢ÁâπÊÆäÊ†∑Âºè - ÂØºËà™Ê†è */
.model-3d-page .navbar {
  background-color: rgba(255, 255, 255, 0.8); /* ÂçäÈÄèÊòéËÉåÊôØ */
  backdrop-filter: blur(5px); /* ËÉåÊôØÊ®°Á≥ä */
  -webkit-backdrop-filter: blur(5px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  position: relative;
  z-index: 100;
}

/* 3DÊ®°ÂûãÈ°µÈù¢ÁâπÊÆäÊ†∑Âºè - È°µËÑö */
.model-3d-page .footer {
  background-color: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
  border-top: 1px solid rgba(234, 234, 234, 0.5);
  position: relative;
  z-index: 100;
}

/* 3DÊ®°ÂûãÈ°µÈù¢ÁâπÊÆäÊ†∑Âºè - ‰∏ªÂÜÖÂÆπÂå∫ */
.model-3d-page .main-content {
  padding: 0;
  max-width: none;
  width: 100%;
}

/* Model3D.vue ‰∏≠Ë¶ÅÊ∑ªÂä†ÁöÑÊ†∑Âºè */

/* È°∂Ê†èÊ†∑ÂºèË∞ÉÊï¥ - ÂáèÂ∞èÈ´òÂ∫¶Âπ∂Âõ∫ÂÆöÂú®È°∂ÈÉ® */
body.model-page .navbar {
  padding: 0.4rem 1rem !important; /* Êõ¥Â∞èÁöÑÂÜÖËæπË∑ù */
  min-height: 36px !important; /* Êõ¥Â∞èÁöÑÊúÄÂ∞èÈ´òÂ∫¶ */
  font-size: 0.9rem !important;
  position: fixed !important; /* Á°Æ‰øùÂõ∫ÂÆöÂú®È°∂ÈÉ® */
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  z-index: 1000 !important;
}

/* È°µÂ∞æÊ†∑ÂºèË∞ÉÊï¥ - ÂáèÂ∞èÈ´òÂ∫¶Âπ∂Âõ∫ÂÆöÂú®Â∫ïÈÉ® */
body.model-page .footer {
  padding: 0.1rem 0 !important; /* Êõ¥Â∞èÁöÑÂÜÖËæπË∑ù */
  font-size: 0.8rem !important;
  position: fixed !important; /* Á°Æ‰øùÂõ∫ÂÆöÂú®Â∫ïÈÉ® */
  bottom: 0 !important;
  left: 0 !important;
  right: 0 !important;
  height: 40px !important; /* Âõ∫ÂÆöÈ´òÂ∫¶ */
  z-index: 1000 !important;
}

/* ËÆ°ÁÆóÈ°∂Ê†èÂíåÈ°µÂ∞æÁöÑÈ´òÂ∫¶ */
:root {
  --navbar-height: 36px; /* È°∂Ê†èÈ´òÂ∫¶ÂåÖÊã¨padding */
  --footer-height: 24px; /* È°µÂ∞æÈ´òÂ∫¶ */
}

/* ÂÆåÂÖ®ÈöêËóèÊªöÂä®Êù°‰ΩÜ‰øùÊåÅÂäüËÉΩ */
.left-panel::-webkit-scrollbar, .right-panel::-webkit-scrollbar {
  width: 4px !important;
}

.left-panel::-webkit-scrollbar-thumb, .right-panel::-webkit-scrollbar-thumb {
  background-color: rgba(0,0,0,0.2) !important;
  border-radius: 2px !important;
}

/* Èù¢ÊùøÂÜÖÈÉ®Ê†∑ÂºèË∞ÉÊï¥Ôºå‰ΩøÂÜÖÂÆπÊõ¥Á¥ßÂáë */
.panel-section {
  padding: 0.75rem !important;
  margin-bottom: 0 !important; /* ‰ΩøÁî®gapÂ±ûÊÄßÊéßÂà∂Èó¥Ë∑ùÔºåËøôÈáå‰∏çÈúÄË¶Åmargin */
  border: 1px solid rgba(0,0,0,0.05) !important; /* Ê∑ªÂä†ÁªÜËæπÊ°ÜÂ¢ûÂº∫ËßÜËßâÂå∫ÂàÜ */
  box-shadow: 0 2px 6px rgba(0,0,0,0.08) !important; /* Â¢ûÂº∫Èò¥ÂΩ±ÊïàÊûú */
}

.panel-title {
  font-size: 0.95rem !important;
  margin: 0 0 0.6rem 0 !important;
  padding-bottom: 0.4rem !important;
  color: #333 !important;
  font-weight: 600 !important;
  border-bottom: 1px solid rgba(0,0,0,0.1) !important; /* Êõ¥ÊòéÊòæÁöÑÂàÜÈöîÁ∫ø */
}

/* ÂáèÂ∞èÂêÑÁßçÊéß‰ª∂ÁöÑÂ∞∫ÂØ∏ */
button, .mac-button {
  padding: 0.4rem 0.8rem !important;
  font-size: 0.9rem !important;
}

.info-content {
  min-height: 80px !important;
  padding: 0.6rem !important;
}

.recent-detections {
  margin-top: 20px;
  border-top: 1px solid #eee;
  padding-top: 10px;
}

.recent-detections h4 {
  font-size: 16px;
  margin-bottom: 10px;
  color: #333;
}

.detection-list {
  max-height: 200px;
  overflow-y: auto;
  border: 1px solid #eaeaea;
  border-radius: 4px;
  background-color: #f9f9f9;
}

.detection-item {
  padding: 8px 12px;
  display: flex;
  align-items: center;
  border-bottom: 1px solid #eee;
  animation: fadeIn 0.5s ease-in-out;
}

.detection-item:last-child {
  border-bottom: none;
}

.detection-time {
  flex: 0 0 80px;
  font-size: 12px;
  color: #666;
}

.detection-type {
  flex: 0 0 50px;
  font-size: 12px;
  padding: 2px 6px;
  border-radius: 10px;
  text-align: center;
  margin: 0 10px;
}

.detection-type-pedestrian {
  background-color: rgba(66, 185, 131, 0.2);
  color: #42b983;
}

.detection-type-vehicle {
  background-color: rgba(32, 150, 243, 0.2);
  color: #229543;
}

.detection-description {
  flex: 1;
  font-size: 13px;
  color: #333;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Êó•ÊúüÁ±ªÂûãÈÄâÊã©Âô®ÂÆπÂô®Ê†∑Âºè */
.day-type-selector {
  display: flex;
  justify-content: center; /* Â±Ö‰∏≠ÊåâÈíÆ */
  gap: 0.8rem; /* ÊåâÈíÆÈó¥Ë∑ù */
  margin-bottom: 1.2rem; /* ‰∏é‰∏ãÊñπÂç°ÁâáÁöÑÈó¥Ë∑ù */
}

/* Ë∞ÉÊï¥ mac-button ÁöÑÊøÄÊ¥ªÁä∂ÊÄÅ (Á°Æ‰øùÊúâËøô‰∏™ÊàñÁ±ª‰ººÁöÑËßÑÂàô) */
/* Â¶ÇÊûúÂ∑≤ÁªèÊúâÂÖ®Â±ÄÁöÑ .mac-button.active Ê†∑ÂºèÔºåÂèØ‰ª•Ë∑≥ËøáÊ≠§Ê≠• */
.mac-button.active {
  background-color: #229543 !important; /* ‰ΩøÁî®Êõ¥ÈÜíÁõÆÁöÑÊøÄÊ¥ªÈ¢úËâ≤Ôºå‰æãÂ¶ÇËìùËâ≤ */
  color: white !important;
  /* ÂèØ‰ª•Ê∑ªÂä†ÂÖ∂‰ªñÊ†∑ÂºèÔºå‰æãÂ¶ÇÁßªÈô§ËæπÊ°Ü */
  border: none; 
}

/* Âü∫Âú∞ÊÄª‰ΩìÂπ≥Èù¢ÂõæÈù¢ÊùøÊ†∑Âºè */
.siteplan-content {
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
}

.siteplan-image-container {
  width: 100%;
  overflow: hidden;
  border-radius: 6px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.siteplan-image {
  width: 100%;
  height: auto;
  display: block;
  transition: transform 0.3s ease;
}

.siteplan-image:hover {
  transform: scale(1.02);
}

.siteplan-controls {
  display: flex;
  justify-content: center;
  gap: 0.8rem;
}

.siteplan-btn {
  flex: 1;
  max-width: 100px;
  font-size: 0.85rem !important;
  padding: 0.35rem 0.6rem !important;
}

.siteplan-btn.active {
  background-color: #229543 !important;
  color: white !important;
  border: none;
}

/* ÊîæÂ§ßÊåâÈíÆÊ†∑Âºè */
.zoom-button-container {
  position: absolute;
  top: 10px;
  right: 10px;
  z-index: 100;
}

.zoom-button {
  background: none;
  border: none;
  font-size: 24px;
  color: white;
  cursor: pointer;
  transition: transform 0.3s ease;
}

.zoom-button:hover {
  transform: scale(1.2);
}

.zoom-icon {
  font-size: 24px;
}

/* ÂÖ®Â±èÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
.siteplan-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1001;
}

.siteplan-modal-content {
  width: 90%;
  max-width: 1200px;
  max-height: 90vh;
  background-color: white;
  border-radius: 8px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.siteplan-modal-body {
  flex: 1;
  overflow: auto;
  padding: 0;
}

.fullscreen-image {
  width: 100%;
  height: auto;
  object-fit: contain;
}

/* ÊîæÂ§ßÊåâÈíÆÊ†∑Âºè */
.siteplan-image-container {
  position: relative;
}

.zoom-button-container {
  position: absolute;
  bottom: 10px;
  right: 10px;
}

.zoom-button {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background-color: rgba(255, 255, 255, 0.8);
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  transition: all 0.2s ease;
}

.zoom-button:hover {
  transform: scale(1.1);
  background-color: white;
}

.zoom-icon {
  font-size: 16px;
}

/* Âπ≥Èù¢ÂõæÂÖ®Â±èÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
.siteplan-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1001;
}

.siteplan-modal-content {
  width: 90%;
  max-width: 1200px;
  max-height: 90vh;
  background-color: white;
  border-radius: 8px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.siteplan-modal-body {
  flex: 1;
  overflow: auto;
  padding: 0;
}

.fullscreen-image {
  width: 100%;
  height: auto;
  object-fit: contain;
}

/* Ê∑ªÂä†ËøõÂ∫¶Êù°Ê†∑Âºè */
.loading-progress {
  margin: 10px 0 15px;
  padding: 10px;
  background-color: rgba(245, 245, 247, 0.8);
  border-radius: 8px;
  border: 1px solid rgba(0, 0, 0, 0.06);
}

.loading-text {
  font-size: 14px;
  margin-bottom: 6px;
  color: #333;
}

.progress-bar {
  height: 8px;
  width: 100%;
  background-color: #e0e0e0;
  border-radius: 4px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background-color: #42b983; /* ‰øùÊåÅ‰∏é‰∏ªÈ¢ò‰∏ÄËá¥ÁöÑÁªøËâ≤ */
  border-radius: 4px;
  transition: width 0.3s ease;
}

.progress-text {
  font-size: 12px;
  text-align: right;
  margin-top: 4px;
  color: #666;
}
</style> 